<!DOCTYPE html>
<html lang="en" dir="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>astra-Sim | WITHER</title>
<meta name="keywords" content="astra-sim">
<meta name="description" content="source code reading of astra-sim">
<meta name="author" content="WITHER">
<link rel="canonical" href="http://localhost:1313/blogs/astra-sim/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.dd3b5b907a50db3238b81d49d094cf1c04a091227797dc9cfde4e2fa3f35df49.css" integrity="sha256-3TtbkHpQ2zI4uB1J0JTPHASgkSJ3l9yc/eTi&#43;j8130k=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png">
<link rel="mask-icon" href="http://localhost:1313/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="http://localhost:1313/blogs/astra-sim/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
<script>
  MathJax = {
    tex: {
      displayMath: [['\\[', '\\]'], ['$$', '$$']],  
      inlineMath: [['\\(', '\\)'], ['$', '$']]  
    }
  };
</script>




<script src="https://cdn.bootcdn.net/ajax/libs/mermaid/9.1.6/mermaid.min.js"></script>
<script>
    mermaid.initialize({
        startOnLoad: true,
        theme: localStorage.getItem("pref-theme") === "dark" ? "dark" : "forest" 
    });
</script>

<meta property="og:url" content="http://localhost:1313/blogs/astra-sim/">
  <meta property="og:site_name" content="WITHER">
  <meta property="og:title" content="astra-Sim">
  <meta property="og:description" content="source code reading of astra-sim">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="blogs">
    <meta property="article:published_time" content="2025-06-09T13:34:39+08:00">
    <meta property="article:modified_time" content="2025-06-13T15:12:24+08:00">
    <meta property="article:tag" content="Astra-Sim">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="astra-Sim">
<meta name="twitter:description" content="source code reading of astra-sim">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Blogs",
      "item": "http://localhost:1313/blogs/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "astra-Sim",
      "item": "http://localhost:1313/blogs/astra-sim/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "astra-Sim",
  "name": "astra-Sim",
  "description": "source code reading of astra-sim",
  "keywords": [
    "astra-sim"
  ],
  "articleBody": "Build Analytical Backend build.sh è„šæœ¬æ˜¯æ„å»ºè¿‡ç¨‹çš„é«˜çº§æ§åˆ¶å™¨ã€‚å…¶æ ¸å¿ƒèŒè´£æ˜¯è§£æç”¨æˆ·æ„å›¾ï¼Œæ‰§è¡Œé¢„æ„å»ºæ­¥éª¤ï¼Œå¹¶ä»¥æ­£ç¡®çš„å‚æ•°è°ƒç”¨åº•å±‚çš„ CMake å·¥å…·é“¾ã€‚\né€‰é¡¹è§£æ: è„šæœ¬é€šè¿‡ getopts å¤„ç†ä»¥ä¸‹å‘½ä»¤è¡Œæ ‡å¿—ï¼š\n-t : æŒ‡å®šç¼–è¯‘ç›®æ ‡ã€‚æœ‰æ•ˆå€¼ä¸º all, congestion_unaware, congestion_awareã€‚æ­¤å€¼å°†ä½œä¸ºå˜é‡ä¼ é€’ç»™ CMakeã€‚ -l: è§¦å‘æ¸…ç† (cleanup) æµç¨‹ï¼Œåˆ é™¤æ‰€æœ‰æ„å»ºäº§ç‰©å¹¶ç»ˆæ­¢è„šæœ¬ã€‚ -d: å¯ç”¨è°ƒè¯• (Debug) æ¨¡å¼è¿›è¡Œç¼–è¯‘ã€‚ ç¯å¢ƒå‡†å¤‡ (setup, compile_chakra_et):\nsetup å‡½æ•°è´Ÿè´£åˆ›å»ºç”¨äºå­˜æ”¾ä¸­é—´æ–‡ä»¶å’Œæœ€ç»ˆäº§ç‰©çš„ build ç›®å½•ï¼Œç¡®ä¿æºç æ ‘çš„æ¸…æ´ã€‚åŒæ—¶ï¼Œå®ƒä¼šæ ¹æ®ç³»ç»Ÿæ ¸å¿ƒæ•°è®¾ç½®ä¸€ä¸ªä¸Šé™ä¸º 16 çš„å¹¶å‘ç¼–è¯‘çº¿ç¨‹æ•°ï¼Œä»¥ä¼˜åŒ–ç¼–è¯‘æ•ˆç‡ã€‚ compile_chakra_et å‡½æ•°è´Ÿè´£å¤„ç† et_def.proto è¿™ä¸€ Protobuf ä¾èµ–ã€‚å®ƒæ£€æŸ¥ç›®æ ‡æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œè‹¥ä¸å­˜åœ¨ï¼Œåˆ™è°ƒç”¨ protoc ç¼–è¯‘å™¨ç”Ÿæˆç›¸åº”çš„ C++ å’Œ Python æºç ã€‚ æ„å»ºæ‰§è¡Œ (compile_astrasim_analytical, compile_astrasim_analytical_as_debug):\nè¿™ä¸¤ä¸ªå‡½æ•°æ˜¯è„šæœ¬ä¸ CMake äº¤äº’çš„æ ¸å¿ƒã€‚å®ƒä»¬æ ¹æ®ç”¨æˆ·æ˜¯å¦æŒ‡å®š -d æ ‡å¿—ï¼Œå†³å®šæ˜¯æ‰§è¡Œæ ‡å‡† Release æ„å»ºè¿˜æ˜¯ Debug æ„å»ºã€‚å…³é”®åœ¨äºå®ƒä»¬ä¼šå°†ç”¨æˆ·æŒ‡å®šçš„ build_target ä½œä¸º -DBUILDTARGET å‚æ•°ä¼ é€’ç»™ CMakeã€‚ åå¤„ç† (create_symlink_*):\nç¼–è¯‘å®Œæˆåï¼Œcreate_symlink_congestion_unaware å’Œ create_symlink_congestion_aware ç­‰å‡½æ•°ä¼šä¸ºç”Ÿæˆçš„äºŒè¿›åˆ¶æ–‡ä»¶åˆ›å»ºç¬¦å·é“¾æ¥ã€‚æ­¤ä¸¾æ—¨åœ¨ç»´æŒå¯¹æ—§æ–‡ä»¶è·¯å¾„çš„å‘åå…¼å®¹æ€§ã€‚ CMakeLists.txt æ–‡ä»¶æ˜¯é¡¹ç›®çš„æ„å»ºè“å›¾ï¼Œå®ƒå‘ CMake é˜è¿°äº†é¡¹ç›®çš„ç»“æ„ã€ä¾èµ–å…³ç³»ä»¥åŠç¼–è¯‘è§„åˆ™ã€‚\nç¼–è¯‘ç¯å¢ƒè®¾å®š:\ncmake_minimum_required(VERSION 3.15): è§„å®šäº†è¿è¡Œæ­¤é…ç½®æ‰€éœ€çš„æœ€ä½ CMake ç‰ˆæœ¬ã€‚ set(CMAKE_CXX_STANDARD 17) å’Œ set(CMAKE_CXX_STANDARD_REQUIRED ON): å¼ºåˆ¶é¡¹ç›®å¿…é¡»åœ¨æ”¯æŒ C++17 æ ‡å‡†çš„ç¼–è¯‘ç¯å¢ƒä¸­æ„å»ºã€‚ ç¼–è¯‘æ ‡å¿— (Compiler Flags):\næ­¤æ–‡ä»¶ä¸ºä¸åŒçš„æ„å»ºç±»å‹ï¼ˆCMAKE_BUILD_TYPEï¼‰å®šä¹‰äº†ä¸åŒçš„ç¼–è¯‘å™¨æ ‡å¿—ã€‚ Release (é»˜è®¤æ¨¡å¼): set(CMAKE_CXX_FLAGS_RELEASE \"-O3\") æŒ‡ç¤ºç¼–è¯‘å™¨è¿›è¡Œé«˜ç­‰çº§ä¼˜åŒ–ï¼Œä»¥è¿½æ±‚æœ€å¤§åŒ–ç¨‹åºæ€§èƒ½ã€‚ Debug: set(CMAKE_CXX_FLAGS_DEBUG \"...\") åŒ…å«ä¸€ç³»åˆ—ç”¨äºè°ƒè¯•çš„æ ‡å¿—ï¼š -O0: å…³é—­æ‰€æœ‰ä¼˜åŒ–ï¼Œç¡®ä¿ç¼–è¯‘åçš„ä»£ç ä¸æºç è¡Œä¸ºä¸€è‡´ã€‚ -g: åœ¨å¯æ‰§è¡Œæ–‡ä»¶ä¸­åŒ…å«è°ƒè¯•ç¬¦å·ï¼Œè¿™æ˜¯ GDB ç­‰è°ƒè¯•å™¨å·¥ä½œçš„å‰æã€‚ -fsanitize=address,undefined,leak: å¯ç”¨ AddressSanitizerã€UndefinedBehaviorSanitizer å’Œ LeakSanitizerã€‚è¿™äº›æ˜¯å¼ºå¤§çš„è¿è¡Œæ—¶è¯Šæ–­å·¥å…·ï¼Œç”¨äºæ•è·å†…å­˜è®¿é—®é”™è¯¯ã€æœªå®šä¹‰è¡Œä¸ºåŠå†…å­˜æ³„æ¼ã€‚ é¡¹ç›®ç»“æ„ä¸ä¾èµ–:\nproject(AstraSim_Analytical): å£°æ˜é¡¹ç›®åç§°ã€‚ add_subdirectory(...): æ­¤æŒ‡ä»¤æ˜¯ç»„ç»‡é¡¹ç›®çš„å…³é”®ã€‚å®ƒå°† AstraSim æ ¸å¿ƒåº“ã€Analytical ç½‘ç»œåç«¯å’Œ AstraSim_Analytical å‰ç«¯ç­‰å¤šä¸ªå­æ¨¡å—çº³å…¥æ„å»ºè¿‡ç¨‹ã€‚ ç”¨æˆ·è‡ªå®šä¹‰é€‰é¡¹:\nset(BUILDTARGET \"all\" CACHE STRING ...): æ­¤è¡Œå®šä¹‰äº†ä¸€ä¸ªåä¸º BUILDTARGET çš„å¯ç¼“å­˜å˜é‡ã€‚è¿™ä½¿å¾—ç”¨æˆ·å¯ä»¥é€šè¿‡ cmake -D å‘½ä»¤ä»å¤–éƒ¨æ³¨å…¥è¯¥å˜é‡çš„å€¼ã€‚æ­¤å˜é‡éšåä¼šè¢«å­ç›®å½•ä¸­çš„ CMakeLists.txt æ–‡ä»¶ç”¨æ¥å®ç°æ¡ä»¶ç¼–è¯‘ã€‚ Build ns-3 Backend æ„å»ºå‘½ä»¤ä¸º ./build/astra_ns3/build.sh -cï¼Œä»–ä¼šæ‰§è¡Œè¯¥è„šæœ¬é‡Œçš„ compile å‡½æ•°\n1 2 3 4 5 6 function compile { cd \"${NS3_DIR}\" ./ns3 configure --enable-mpi ./ns3 build AstraSimNetwork -j 12 cd \"${SCRIPT_DIR:?}\" } ./ns3 configure --enable-mpi å‚æ•°è§£æ (parse_args): è„šæœ¬çš„ argparse æ¨¡å—ä¼šè¯†åˆ«å‡º configure å­å‘½ä»¤å’Œ --enable-mpi é€‰é¡¹ã€‚--enable-mpi æ˜¯ä¸€ä¸ªé¢„å®šä¹‰çš„\"On-Off\"é€‰é¡¹ï¼Œç”¨äºæ§åˆ¶ MPI (Message Passing Interface) åˆ†å¸ƒå¼ä»¿çœŸåŠŸèƒ½çš„æ”¯æŒã€‚ è¿›å…¥é…ç½®æ­¥éª¤ (configuration_step): ç”±äºæ£€æµ‹åˆ° configure å‘½ä»¤ï¼Œè„šæœ¬ä¼šè°ƒç”¨ configuration_step å‡½æ•°ã€‚ è°ƒç”¨ CMake (configure_cmake): configuration_step å‡½æ•°å†…éƒ¨ä¼šè°ƒç”¨ configure_cmake. è¿™ä¸ªå‡½æ•°æ˜¯ä¼šåŠ¨æ€åœ°æ„å»ºä¸€ä¸ª cmake å‘½ä»¤ã€‚ å®ƒä¼šæ£€æµ‹åˆ° --enable-mpi é€‰é¡¹ï¼Œå¹¶é€šè¿‡ on_off_condition å‡½æ•°å°†å…¶è½¬æ¢ä¸º CMake å˜é‡ -DNS3_MPI=ON. æœ€ç»ˆç»„è£…å‡ºçš„å‘½ä»¤ä¸ºä¸º cmake -S . -B cmake-cache -G \"Unix Makefiles\" -DCMAKE_BUILD_TYPE=default -DNS3_ASSERT=ON -DNS3_LOG=ON -DNS3_WARNINGS_AS_ERRORS=OFF -DNS3_MPI=ON --warn-uninitialized æ‰§è¡Œé…ç½®: è„šæœ¬é€šè¿‡ subprocess.run() æ‰§è¡Œè¿™æ¡ cmake å‘½ä»¤ ./ns3 build AstraSimNetwork -j 12 å‚æ•°è§£æ (parse_args): è„šæœ¬è¯†åˆ«å‡º build å­å‘½ä»¤ï¼Œç›®æ ‡ AstraSimNetworkï¼Œä»¥åŠå¹¶è¡Œä»»åŠ¡æ•° -j 12. å‰è€…ä¼šè¢«å­˜å…¥ args.build åˆ—è¡¨ï¼Œåè€…ä¼šè¢«å­˜å…¥ args.jobs. è¿›å…¥æ„å»ºæ­¥éª¤ (build_step): è„šæœ¬æ£€æµ‹åˆ° build å‘½ä»¤ï¼Œå¹¶è°ƒç”¨ build_step å‡½æ•°ã€‚ è°ƒç”¨ CMake æ„å»º (cmake_build): build_step å‡½æ•°ä¼šéå† args.build åˆ—è¡¨ä¸­çš„æ‰€æœ‰ç›®æ ‡ã€‚åœ¨è¿™é‡Œï¼Œå®ƒä¼šä¸º AstraSimNetwork è¿™ä¸ªç›®æ ‡è°ƒç”¨ cmake_build å‡½æ•°ã€‚ cmake_build å‡½æ•°ä¼šç»„è£…å‡ºä¸€æ¡ cmake --build å‘½ä»¤ã€‚ å°†ç›®æ ‡ AstraSimNetwork è½¬æ¢ä¸º --target AstraSimNetwork. å°†å¹¶è¡Œä»»åŠ¡æ•° 12 è½¬æ¢ä¸º -j 12. æœ€ç»ˆç»„è£…å‡ºçš„å‘½ä»¤ä¸º cmake --build cmake-cache --target AstraSimNetwork -j 12. Error When Building ns-3 call of overloaded â€˜format(â€¦)â€™ is ambiguous âŒ é—®é¢˜è¯Šæ–­ ğŸ©º é”™è¯¯ä¿¡æ¯ call of overloaded â€˜format(...)â€™ is ambiguous çš„æ„æ€æ˜¯ï¼Œç¼–è¯‘å™¨åœ¨ä½ çš„ä»£ç ä¸­é‡åˆ°äº†ä¸€ä¸ªåä¸º format çš„å‡½æ•°è°ƒç”¨ï¼Œä½†å®ƒæ‰¾åˆ°äº†å¤šä¸ªåŒåçš„ã€å¹¶ä¸”å‚æ•°ç±»å‹éƒ½èƒ½åŒ¹é…çš„ format å‡½æ•°å®šä¹‰ï¼Œå¯¼è‡´ç¼–è¯‘å™¨ä¸çŸ¥é“è¯¥é€‰æ‹©å“ªä¸€ä¸ªï¼Œå› æ­¤äº§ç”Ÿäº†â€œæ­§ä¹‰â€ï¼ˆambiguousï¼‰ã€‚\nè¿™ä¸ªæ­§ä¹‰çš„æ¥æºæ˜¯ï¼š\nstd::format (æ¥è‡ª C++20 æ ‡å‡†åº“): ä½ çš„é¡¹ç›®å¾ˆå¯èƒ½æ­£åœ¨ä½¿ç”¨æ”¯æŒ C++20 æˆ–æ›´é«˜ç‰ˆæœ¬çš„ç°ä»£ç¼–è¯‘å™¨ï¼ˆå¦‚ GCC 11+ï¼‰ã€‚C++20 æ ‡å‡†åº“å¼•å…¥äº†ä¸€ä¸ªæ–°çš„æ ¼å¼åŒ–å‡½æ•° std::formatã€‚ fmt::format (æ¥è‡ª {fmt} åº“): spdlog è¿™ä¸ªæ—¥å¿—åº“æ˜¯åŸºäºä¸€ä¸ªéå¸¸æµè¡Œçš„ç¬¬ä¸‰æ–¹æ ¼å¼åŒ–åº“ {fmt} æ„å»ºçš„ã€‚è¿™ä¸ªåº“ä¹Ÿæä¾›äº†ä¸€ä¸ªåŠŸèƒ½å‡ ä¹å®Œå…¨ç›¸åŒçš„ fmt::format å‡½æ•°ã€‚åœ¨ spdlog çš„ä¸Šä¸‹æ–‡ä¸­ï¼Œå®ƒé€šå¸¸å¯ä»¥ç›´æ¥ä»¥ format çš„å½¢å¼è¢«è°ƒç”¨ã€‚ å½“ä½ çš„ä»£ç ï¼ˆè¿™é‡Œæ˜¯ spdlog_setup çš„ä¸€éƒ¨åˆ†ï¼‰ç®€å•åœ°è°ƒç”¨ format(...) æ—¶ï¼Œå¦‚æœ C++20 çš„ å¤´æ–‡ä»¶è¢«åŒ…å«ï¼Œç¼–è¯‘å™¨å°±ä¼šåŒæ—¶çœ‹åˆ° std::format å’Œ spdlog å†…éƒ¨çš„ fmt::formatã€‚ç”±äºä¸¤è€…éƒ½èƒ½å¤„ç†å­—ç¬¦ä¸²å­—é¢é‡ (const char[]) å’Œ std::stringï¼Œç¼–è¯‘å™¨æ— æ³•å†³å®šç”¨å“ªä¸ªï¼Œä»è€ŒæŠ¥é”™ã€‚\nå…³äº using fmt::format; ä¸ºä½•ä»ç„¶æ— æ•ˆçš„è§£é‡Š åŸå› æ˜¯ï¼Œé™¤äº†å¸¸è§„çš„å‘½åç©ºé—´æŸ¥æ‰¾è§„åˆ™ï¼ŒC++ è¿˜æœ‰ä¸€ä¸ªæ›´å¼ºå¤§çš„è§„åˆ™å«åšå‚æ•°ä¾èµ–æŸ¥æ‰¾ï¼ˆArgument-Dependent Lookup, ADLï¼‰ï¼Œæœ‰æ—¶ä¹Ÿè¢«ç§°ä¸º Koenig æŸ¥æ‰¾ã€‚\næˆ‘ä»¬æ¥æ¢³ç†ä¸€ä¸‹ç¼–è¯‘å™¨åœ¨çœ‹åˆ° format(...) è¿™è¡Œä»£ç æ—¶çš„â€œæ€è€ƒè¿‡ç¨‹â€ï¼š\nåœ¨å½“å‰ä½œç”¨åŸŸæŸ¥æ‰¾\nç¼–è¯‘å™¨çœ‹åˆ°äº†ä½ çš„ using fmt::format; å£°æ˜ã€‚å¾ˆå¥½ï¼Œå®ƒåœ¨å½“å‰ä½œç”¨åŸŸé‡Œæ‰¾åˆ°äº†ä¸€ä¸ªå«åš format çš„å‡½æ•°ï¼ˆä¹Ÿå°±æ˜¯ fmt::formatï¼‰ã€‚è¿™æˆä¸ºäº†å€™é€‰è€… Aã€‚\nå‚æ•°ä¾èµ–æŸ¥æ‰¾ (ADL) â€”â€” é—®é¢˜çš„æ ¹æº\næ¥ä¸‹æ¥ï¼Œç¼–è¯‘å™¨ä¼šæ£€æŸ¥ format(...) å‡½æ•°çš„æ‰€æœ‰å‚æ•°ç±»å‹ã€‚åœ¨ä½ çš„é”™è¯¯æ—¥å¿—é‡Œï¼Œæˆ‘ä»¬çœ‹åˆ°äº† const std::string\u0026 è¿™æ ·çš„å‚æ•°ã€‚\nADL è§„åˆ™è§„å®šï¼šå¦‚æœä¸€ä¸ªå‡½æ•°çš„å‚æ•°æ˜¯æŸä¸ªå‘½åç©ºé—´ N ä¸‹çš„ç±»å‹ï¼ˆæ¯”å¦‚ std::string æ˜¯ std å‘½åç©ºé—´ä¸‹çš„ï¼‰ï¼Œé‚£ä¹ˆç¼–è¯‘å™¨ä¹Ÿå¿…é¡»å»é‚£ä¸ªå‘½åç©ºé—´ N (è¿™é‡Œæ˜¯ std) é‡Œé¢å»æŸ¥æ‰¾åŒåçš„å‡½æ•°ã€‚ ç”±äº std::string æ˜¯ std å‘½åç©ºé—´çš„æˆå‘˜ï¼ŒADL è§„åˆ™è¢«è§¦å‘ï¼Œç¼–è¯‘å™¨è‡ªåŠ¨åœ°å» std å‘½åç©ºé—´é‡Œå¯»æ‰¾åä¸º format çš„å‡½æ•°ã€‚ å› ä¸ºä½ ä½¿ç”¨äº† C++20 ç¼–è¯‘å™¨ï¼Œå®ƒåœ¨ std å‘½åç©ºé—´é‡ŒæˆåŠŸæ‰¾åˆ°äº† std::formatã€‚è¿™æˆä¸ºäº†å€™é€‰è€… Bã€‚ äº§ç”Ÿæ­§ä¹‰\nç°åœ¨ç¼–è¯‘å™¨é™·å…¥äº†å›°å¢ƒã€‚å®ƒæ‰‹å¤´æœ‰ä¸¤ä¸ªåŒæ ·åŒ¹é…çš„å€™é€‰å‡½æ•°ï¼š\nå€™é€‰è€… A: fmt::format (é€šè¿‡ using å£°æ˜æ‰¾åˆ°) å€™é€‰è€… B: std::format (é€šè¿‡ ADL åœ¨å‚æ•°çš„å‘½åç©ºé—´é‡Œæ‰¾åˆ°) using å£°æ˜åªæ˜¯å°†ä¸€ä¸ªåå­—å¼•å…¥å½“å‰ä½œç”¨åŸŸï¼Œå®ƒå¹¶**æ²¡æœ‰è¶³å¤Ÿçš„â€œç‰¹æƒâ€**å»å‹åˆ¶ä¸€ä¸ªé€šè¿‡ ADL æ‰¾åˆ°çš„åŒæ ·ä¼˜ç§€çš„å€™é€‰è€…ã€‚å› ä¸ºä¸¤ä¸ªå‡½æ•°éƒ½èƒ½å®Œç¾å¤„ç†ä½ ä¼ å…¥çš„å‚æ•°ï¼Œç¼–è¯‘å™¨æ— æ³•åšå‡ºé€‰æ‹©ï¼Œæ‰€ä»¥å®ƒåªèƒ½æ”¾å¼ƒå¹¶æŠ¥å‘Šâ€œè°ƒç”¨æ˜¯æ¨¡ç³Šçš„ (ambiguous)â€ã€‚\nç»“è®ºä¸æœ€ç»ˆè§£å†³æ–¹æ¡ˆ âœ… è¿™ä¸ª C++ çš„ç‰¹æ€§æ„å‘³ç€ï¼Œåªè¦ä½ çš„å‡½æ•°å‚æ•°ä¸­åŒ…å«äº† std å‘½åç©ºé—´é‡Œçš„ç±»å‹ï¼ˆå¦‚ std::string, std::vector ç­‰ï¼‰ï¼ŒADL å°±æœ‰å¯èƒ½è¢«è§¦å‘ï¼Œä»è€ŒæŠŠ std é‡Œçš„å‡½æ•°ï¼ˆå¦‚ std::format, std::to_string ç­‰ï¼‰ä¹Ÿæ‹‰å…¥å€™é€‰åˆ—è¡¨ï¼Œé€ æˆæ„æƒ³ä¸åˆ°çš„å†²çªã€‚\nå› æ­¤ï¼Œå”¯ä¸€èƒ½ 100% æ¶ˆé™¤æ­§ä¹‰ã€è®©ç¼–è¯‘å™¨åˆ«æ— é€‰æ‹©çš„æ–¹æ³•ï¼Œå°±æ˜¯ä½¿ç”¨æ˜¾å¼çš„å‘½åç©ºé—´é™å®šï¼š\n1 2 3 // è¿™æ ·åšï¼Œæ˜¯åœ¨ç›´æ¥å‘Šè¯‰ç¼–è¯‘å™¨ï¼šâ€œåˆ«å»çŒœäº†ï¼Œæˆ‘å°±æ˜¯è¦è°ƒç”¨ fmt å‘½åç©ºé—´é‡Œçš„è¿™ä¸ª formatï¼â€ // è¿™ä¼šå®Œå…¨ç»•è¿‡ ADL å’Œå…¶ä»–æŸ¥æ‰¾è§„åˆ™ï¼Œç›´è¾¾ç›®æ ‡ã€‚ fmt::format(...); Runing Arguments æ‰§è¡Œä»¿çœŸéœ€è¦ä¼ é€’ä¸€äº›å‚æ•°ï¼Œå‘½ä»¤æ¨¡æ¿å¦‚ä¸‹\n1 2 3 4 5 {ASTRA_SIM_BIN} \\ --workload-configuration=${WORKLOAD_CONFIG} \\ --system-configuration=${SYSTEM_CONFIG} \\ --network-configuration=${NETWORK_CONFIG} \\ --remote-memory-configuration=${REMOTE_MEMORY_CONFIG} WORKLOAD_CONFIG astra-sim ä½¿ç”¨çš„æ˜¯ Chakra (Execution Trace) ä½œä¸º workload å±‚çš„è¾“å…¥ã€‚å°† chakra ä½œä¸º python package å®‰è£…åæœ‰å‡ ä¸ªå‘½ä»¤é€šè¿‡ pyproject.toml å¯¹åº”åˆ° pythonå‡½æ•°ã€‚\nExplanation of toml file pyproject.toml æ˜¯ä¸€ä¸ªæ ‡å‡†åŒ–çš„é…ç½®æ–‡ä»¶ï¼Œç”¨äºå®šä¹‰ Python é¡¹ç›®çš„å…ƒæ•°æ®ã€ä¾èµ–å…³ç³»ä»¥åŠæ„å»ºå’Œå¼€å‘å·¥å…·çš„é…ç½®ã€‚\n[build-system] æ„å»ºç³»ç»Ÿé…ç½®ï¼Œè¿™éƒ¨åˆ†å®šä¹‰äº†å¦‚ä½•æ„å»ºä½ çš„ Python åŒ…ã€‚ **requires**: åˆ—å‡ºäº†æ„å»ºé¡¹ç›®æœ¬èº«æ‰€å¿…éœ€çš„åŒ…ã€‚è¿™äº›æ˜¯æ„å»ºç¯å¢ƒçš„ä¾èµ–ï¼Œè€Œä¸æ˜¯ä½ ä»£ç è¿è¡Œæ—¶çš„ä¾èµ–ã€‚ setuptools, setuptools-grpc: è¡¨æ˜æ­¤é¡¹ç›®ä½¿ç”¨ setuptools ä½œä¸ºå…¶æ„å»ºå·¥å…·ï¼Œå¹¶éœ€è¦ setuptools-grpc æ’ä»¶ã€‚ **build-backend**: æŒ‡å®šäº†æ„å»ºå·¥å…·ä¸­å®é™…æ‰§è¡Œæ„å»ºè¿‡ç¨‹çš„ Python å¯¹è±¡ï¼ˆå…¥å£ç‚¹ï¼‰ã€‚ setuptools.build_meta: è¿™æ˜¯ setuptools æä¾›çš„æ ‡å‡†æ„å»ºåç«¯ã€‚ [project]ï¼šè¿™éƒ¨åˆ†åŒ…å«äº†é¡¹ç›®çš„åŸºæœ¬ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯ä¼šå±•ç¤ºåœ¨ PyPI (Python Package Index) ä¸Šã€‚ **name**: åŒ…çš„åç§°ï¼Œå³ pip install chakra ä¸­çš„ chakraã€‚ **requires-python**: è¿è¡Œæ­¤åŒ…æ‰€éœ€çš„æœ€ä½ Python ç‰ˆæœ¬ï¼Œè¿™é‡Œæ˜¯ 3.7 æˆ–æ›´é«˜ã€‚ **version**: å½“å‰åŒ…çš„ç‰ˆæœ¬å·ã€‚ **readme**: æŒ‡å‘ä¸€ä¸ªæ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶çš„å†…å®¹å°†ä½œä¸ºé¡¹ç›®åœ¨ PyPI ä¸Šçš„è¯¦ç»†æè¿°ã€‚ **license**: æŒ‡å‘åŒ…å«è®¸å¯è¯ä¿¡æ¯çš„æ–‡ä»¶ã€‚ **authors**ï¼šé¡¹ç›®çš„ä½œè€…ä¿¡æ¯ã€‚ **dependencies**: é¡¹ç›®è¿è¡Œæ—¶çš„ä¾èµ–é¡¹ã€‚å½“ç”¨æˆ· pip install chakra æ—¶ï¼Œè¿™äº›åŒ…ä¹Ÿä¼šè¢«ä¸€å¹¶å®‰è£…ã€‚ protobuf==5.*: éœ€è¦ç‰ˆæœ¬ä¸º 5.x çš„ protobuf åº“ã€‚ graphviz, networkx, pydot: å…¶ä»–æ ‡å‡†çš„ç¬¬ä¸‰æ–¹åº“ä¾èµ–ã€‚ HolisticTraceAnalysis @ git+...: è¿™æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ä¾èµ–ã€‚å®ƒç›´æ¥ä» GitHub ä»“åº“çš„ä¸€ä¸ªç‰¹å®š commit (d731cc...) æ¥å®‰è£…ã€‚è¿™ç¡®ä¿äº†é¡¹ç›®ä¾èµ–äºä¸€ä¸ªç¨³å®šä¸”ä¸ä¼šæ„å¤–å˜åŠ¨çš„ç‰ˆæœ¬ã€‚ [project.urls]ï¼šé¡¹ç›®ç›¸å…³é“¾æ¥ï¼Œè¿™äº›é“¾æ¥ä¼šæ˜¾ç¤ºåœ¨ PyPI é¡µé¢çš„ä¾§è¾¹æ ï¼Œä¸ºç”¨æˆ·æä¾›æ›´å¤šä¿¡æ¯çš„å…¥å£ã€‚ **Homepage**, **Documentation**, **Repository**: åˆ†åˆ«æŒ‡å‘é¡¹ç›®ä¸»é¡µã€æ–‡æ¡£å’Œä»£ç ä»“åº“çš„ URLã€‚ [tool.setuptools]ï¼šè¿™éƒ¨åˆ†æ˜¯é’ˆå¯¹æ„å»ºå·¥å…· setuptools çš„è¯¦ç»†é…ç½®ã€‚ **package-dir**: å®šä¹‰äº† Python åŒ…åä¸å®é™…æºä»£ç ç›®å½•ä¹‹é—´çš„æ˜ å°„å…³ç³»ã€‚ ä¾‹å¦‚ï¼Œ\"chakra.src.converter\" = \"src/converter\" è¡¨ç¤ºå½“ç”¨æˆ· import chakra.src.converter æ—¶ï¼ŒPython ä¼šä» src/converter/ ç›®å½•ä¸‹å¯»æ‰¾ä»£ç ã€‚è¿™ä½¿å¾—é¡¹ç›®å¯ä»¥ä½¿ç”¨ src å¸ƒå±€ã€‚ **package-data**: æŒ‡å®šéœ€è¦åŒ…å«åœ¨æœ€ç»ˆå‘å¸ƒåŒ…ä¸­çš„é Python æ–‡ä»¶ã€‚ \"chakra.schema.protobuf\" = [\"et_def.proto\"]: è¡¨ç¤ºéœ€è¦å°† et_def.proto è¿™ä¸ªæ–‡ä»¶æ‰“åŒ…åˆ° chakra.schema.protobuf è¿™ä¸ªåŒ…é‡Œã€‚ [project.scripts]ï¼šè¿™éƒ¨åˆ†å®šä¹‰äº†åœ¨å®‰è£…åŒ…æ—¶åº”åˆ›å»ºçš„å‘½ä»¤è¡Œå·¥å…·ã€‚ **chakra_converter = \"chakra.src.converter.converter:main\"**: è¿™è¡Œé…ç½®æ„å‘³ç€ï¼Œå½“ç”¨æˆ·å®‰è£…æ­¤åŒ…åï¼Œä»–ä»¬å¯ä»¥åœ¨ç»ˆç«¯ä¸­ç›´æ¥è¿è¡Œ chakra_converter å‘½ä»¤ã€‚æ‰§è¡Œæ­¤å‘½ä»¤æ—¶ï¼Œç³»ç»Ÿä¼šè°ƒç”¨ chakra.src.converter.converter æ¨¡å—ä¸­çš„ main å‡½æ•°ã€‚ [tool.ruff]ï¼šè¿™éƒ¨åˆ†æ˜¯ç”¨äºé…ç½® Ruff é«˜æ€§èƒ½ä»£ç æ£€æŸ¥ï¼ˆLinterï¼‰å’Œæ ¼å¼åŒ–ï¼ˆFormatterï¼‰å·¥å…·ã€‚ **target-version**, **line-length**, **exclude**: åŸºæœ¬é…ç½®ï¼Œå¦‚ç›®æ ‡ Python ç‰ˆæœ¬ã€æ¯è¡Œæœ€å¤§é•¿åº¦å’Œè¦æ’é™¤æ£€æŸ¥çš„æ–‡ä»¶ã€‚ **[tool.ruff.lint]**: Linter çš„å…·ä½“é…ç½®ã€‚ **select**: å¯ç”¨ä¸€ç³»åˆ—ä»£ç è§„åˆ™é›†ï¼ˆä¾‹å¦‚ D ä»£è¡¨æ–‡æ¡£å­—ç¬¦ä¸² pydocstyleï¼ŒI ä»£è¡¨å¯¼å…¥æ’åº isortï¼‰ã€‚ **ignore**: å…¨å±€ç¦ç”¨çš„ç‰¹å®šè§„åˆ™ã€‚æ³¨é‡Šä¸­è§£é‡Šäº†å¿½ç•¥å®ƒä»¬çš„åŸå› ï¼ˆä¾‹å¦‚ï¼Œè§„åˆ™å†²çªæˆ–å¾…åŠäº‹é¡¹ï¼‰ã€‚ **per-file-ignores**: é’ˆå¯¹ç‰¹å®šæ–‡ä»¶æˆ–ç›®å½•ç¦ç”¨è§„åˆ™ã€‚ä¾‹å¦‚ï¼Œ\"**/tests/*\" = [\"D\"] è¡¨ç¤ºåœ¨æ‰€æœ‰æµ‹è¯•æ–‡ä»¶ä¸­éƒ½ç¦ç”¨æ–‡æ¡£å­—ç¬¦ä¸²æ£€æŸ¥ã€‚ **[tool.ruff.format]**: æ ¼å¼åŒ–å™¨çš„é…ç½®ï¼Œå¦‚ä½¿ç”¨ç©ºæ ¼ä½œä¸ºç¼©è¿›é£æ ¼ã€‚ [tool.pyright]ï¼šè¿™éƒ¨åˆ†é…ç½®äº† Pyrightï¼Œä¸€ä¸ªç”±å¾®è½¯å¼€å‘çš„é™æ€ç±»å‹æ£€æŸ¥å·¥å…·ã€‚ **typeCheckingMode**: ç±»å‹æ£€æŸ¥çš„ä¸¥æ ¼ç¨‹åº¦ï¼Œè¿™é‡Œæ˜¯ basicï¼ˆåŸºç¡€æ¨¡å¼ï¼‰ã€‚ **exclude**ï¼šåœ¨è¿›è¡Œç±»å‹æ£€æŸ¥æ—¶è¦å¿½ç•¥çš„æ–‡ä»¶å’Œç›®å½•ã€‚ **report...**ï¼šå…³é—­ç‰¹å®šçš„é”™è¯¯æˆ–è­¦å‘ŠæŠ¥å‘Šã€‚ [tool.vulture]ï¼šè¿™éƒ¨åˆ†é…ç½®äº† Vultureï¼Œä¸€ä¸ªç”¨äºå‘ç°é¡¹ç›®ä¸­æœªä½¿ç”¨ï¼ˆâ€œæ­»â€ï¼‰ä»£ç çš„å·¥å…·ã€‚ **ignore_names**: è®© Vulture å¿½ç•¥æŸäº›ç‰¹å®šçš„å˜é‡åæˆ–å‡½æ•°åï¼Œå³ä½¿å®ƒä»¬çœ‹èµ·æ¥æœªä½¿ç”¨ã€‚ **min_confidence**: è®¾ç½®æŠ¥å‘Šé—®é¢˜çš„æœ€ä½ç½®ä¿¡åº¦é˜ˆå€¼ã€‚100 è¡¨ç¤ºåªæœ‰åœ¨ Vulture 100% ç¡®å®šä»£ç æ˜¯æ— ç”¨çš„æ—¶å€™æ‰ä¼šæŠ¥å‘Šï¼Œè¿™å¯ä»¥æœ‰æ•ˆå‡å°‘è¯¯æŠ¥ã€‚ 1 2 3 4 5 6 7 [project.scripts] chakra_converter = \"chakra.src.converter.converter:main\" chakra_generator = \"chakra.src.generator.generator:main\" chakra_jsonizer = \"chakra.src.jsonizer.jsonizer:main\" chakra_timeline_visualizer = \"chakra.src.timeline_visualizer.timeline_visualizer:main\" chakra_trace_link = \"chakra.src.trace_link.trace_link:main\" chakra_visualizer = \"chakra.src.visualizer.visualizer:main\" Generate Execution Trace ASTRA-sim çš„ ET å‘½åæ ¼å¼ä¸º {path prefix/trace name}.{npu_id}.et. Chakra ET çš„è·å–æµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤º1ã€‚\nCollect ET from PyTorch PyTorch ET è´Ÿè´£ CPU ç®—å­ï¼Œå¹¶æ˜ç¡®è¡¨ç¤ºå®ƒä»¬ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚ Kineto Trace ç¼–ç  GPU ç®—å­åŠå…¶å¼€å§‹å’Œç»“æŸæ—¶é—´ã€‚ Merge Trace by chkra_trace_linkï¼šå°†å®ƒä»¬åˆå¹¶ä¸ºä¸€ä¸ª PyTorch ET+. è¯¥æ ¼å¼æœ¬è´¨ä¸Šéµå¾ª PyTorch ET çš„æ¨¡å¼ï¼Œä½†åŒæ—¶ä¹Ÿç¼–ç äº† GPU æ“ä½œç¬¦åŠå…¶ä¾èµ–å…³ç³»ã€‚ Convert to Chakra ET by chakra_converter Overview of Trace Collection å…·ä½“çš„æ•™ç¨‹å’Œä¾‹å­å¯ä»¥åœ¨ Conversion Guide å’Œ Practical Example æ‰¾åˆ°ã€‚\nUsing ET Converter å¯ä»¥å°† astra-sim 1.0 çš„æ–‡æœ¬è¾“å…¥è½¬æ¢æˆ Chakra ET.\n1 2 3 4 5 6 7 cd ./extern/graph_frontend/chakra/ pip3 install . chakra_converter Text \\ --input ../../../examples/text_converter/text_workloads/Resnet50_DataParallel.txt \\ --output ../../../examples/text_converter/text_workloads/Resnet50_DataParallel \\ --num-npus 8 \\ --num-passes 1 workload æ–‡æœ¬æ ¼å¼è¦æ±‚å¦‚ä¸‹ï¼Œå…¶ä¸­é€šä¿¡å¤§å°å•ä½æ˜¯å­—èŠ‚ï¼Œè®¡ç®—æ—¶é—´ä»¥å‘¨æœŸæ•°è¡¨ç¤ºã€‚\nç¬¬ä¸€è¡Œï¼š(DATA/HYBRID_TRANSFORMER/HYBRID_DLRM) è¯¥è¡ŒæŒ‡å®šè®­ç»ƒå¾ªç¯çš„å¹¶è¡ŒåŒ–ç±»å‹ã€‚DATA è¡¨ç¤ºçº¯æ•°æ®å¹¶è¡Œæ–¹æ³•ï¼ŒHYBRID_TRANSFORMER è¡¨ç¤ºä¸“ä¸º Transformer DNN ç½‘ç»œè®¾è®¡çš„æ··åˆå¹¶è¡Œæ–¹æ³•ï¼Œè€Œ HYBRID_DLRM è¡¨ç¤ºä¸“ä¸º DLRM DNN ç½‘ç»œä¼˜åŒ–çš„æ··åˆå¹¶è¡Œæ–¹æ³•ã€‚ ç¬¬äºŒè¡Œï¼š(int) è¯¥è¡Œè¡¨ç¤º DNN çš„å±‚æ•°ã€‚ åç»­è¡Œï¼šæ¯è¡Œæè¿°ä¸€å±‚ã€‚å±‚çš„æè¿°æ ¼å¼å¦‚ä¸‹ï¼š {(string: å±‚åç§°) (int: ä¿ç•™å˜é‡) (int: å‰å‘è®¡ç®—æ—¶é—´) (ALLREDUCE/ALLGATHER/ALLTOALL: å‰å‘é€šä¿¡ç±»å‹) (int: å‰å‘é€šä¿¡å¤§å°) (int: è¾“å…¥æ¢¯åº¦è®¡ç®—æ—¶é—´) (ALLREDUCE/ALLGATHER/ALLTOALL: è¾“å…¥æ¢¯åº¦é€šä¿¡ç±»å‹) (int: è¾“å…¥æ¢¯åº¦é€šä¿¡å¤§å°) (int: æƒé‡æ¢¯åº¦è®¡ç®—æ—¶é—´) (ALLREDUCE/ALLGATHER/ALLTOALL: æƒé‡æ¢¯åº¦é€šä¿¡ç±»å‹) (int: æƒé‡æ¢¯åº¦é€šä¿¡å¤§å°) (é›†åˆé€šä¿¡å®Œæˆåï¼Œæƒé‡/è¾“å…¥/è¾“å‡ºæ›´æ–°çš„å»¶è¿Ÿ)}` Note\næ¯ä¸€å±‚çš„å‚æ•°å†™è¦åœ¨åŒä¸€è¡Œï¼ï¼ï¼\nEnable Communicator Groups astra-sim 2.0 æ”¯æŒé€šä¿¡ç»„ã€‚å¯ä»¥é€šè¿‡æŒ‡å®š --comm-group-configuration JSON æ–‡ä»¶æ¥æŒ‡å®šï¼Œé»˜è®¤åªæœ‰ä¸€ä¸ªé€šä¿¡ç»„ã€‚\n{ // The first/second communicator group, with ID 0/1, includes GPU IDs from 0-3/4-7. // \"0\": [0, 1, 2, 3], // \"1\": [4, 5, 6, 7] \"\" : [gpu_ids] } SYSTEM_CONFIG System Layer Workload å±‚ä¼šéå† Chakra ET ä¸­çš„èŠ‚ç‚¹ï¼Œå¹¶ä¸ºæ¯ä¸ªèŠ‚ç‚¹æ‰€æŒ‡ä»£çš„æ“ä½œå‘å‡ºç›¸åº”çš„å‘½ä»¤ã€‚System å±‚æ¥æ”¶è¿™äº›å‘½ä»¤ï¼Œå¹¶å°†å…¶è½¬æ¢ä¸ºé€‚åˆç½‘ç»œã€è®¡ç®—æˆ–å†…å­˜åç«¯çš„æ ¼å¼ï¼Œä»è€Œæ­£ç¡®æ¨¡æ‹Ÿæ“ä½œã€‚æ ¹æ®æ“ä½œçš„ç±»å‹ï¼Œç³»ç»Ÿå±‚çš„è¡Œä¸ºä¼šæœ‰æ‰€ä¸åŒï¼Œå…·ä½“å¦‚ä¸‹ï¼š\nè®¡ç®—æ“ä½œï¼šå‘è®¡ç®—åç«¯å‘å‡ºè°ƒç”¨ï¼Œä»¥æ¨¡æ‹Ÿæ“ä½œçš„æŒç»­æ—¶é—´ã€‚ å†…å­˜æ“ä½œï¼š å†…å­˜ é€šä¿¡æ“ä½œï¼šå°†é›†åˆé€šä¿¡åˆ†è§£ä¸ºç‚¹å¯¹ç‚¹çš„å‘é€å’Œæ¥æ”¶æ¶ˆæ¯ï¼Œå¹¶å‘ç½‘ç»œåç«¯å‘å‡ºâ€œå‘é€â€æˆ–â€œæ¥æ”¶â€è°ƒç”¨ï¼Œä»¥æ¨¡æ‹Ÿæ¶ˆæ¯çš„ä¼ è¾“è¿‡ç¨‹ã€‚ Collective Scheduler Collective Scheduler\næ¯ä¸ªé˜Ÿåˆ—éƒ½æœ‰è®¸å¤š StreamBaseline å¯¹è±¡ (å›¾ä¸­å³ä¸Šè§’)ï¼Œä»£è¡¨äº†æ•´ä¸ªé›†åˆé€šä¿¡çš„æµç¨‹ï¼Œphase_to_go æ˜¯ä¸€ä¸ªç”¨äºè¡¨ç¤ºè¿™äº›é˜¶æ®µçš„é˜Ÿåˆ—ï¼Œmy_current_phase æ˜¯æŒ‡å‘å½“å‰æ‰§è¡Œé˜¶æ®µçš„æŒ‡é’ˆã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 class StreamBaseline : public BaseStream { public: StreamBaseline(Sys* owner, DataSet* dataset, int stream_id, std::list\u003cCollectivePhase\u003e phases_to_go, int priority); // my_current_phase[CollectivePhase] is defined in BaseStream void init(); void call(EventType event, CallData* data); void consume(RecvPacketEventHandlerData* message); }; å¯¹äºæ¯ä¸ª stream proceed_to_next_vnet_baseline (astra-sim/system/Sys.cc) ç”¨äºæ¨è¿›é€šä¿¡é˜¶æ®µå¹¶ä¸”è´Ÿè´£åœ¨é˜Ÿåˆ—ä¹‹é—´ç§»åŠ¨ stream å¯¹è±¡ã€‚ä»¥ä¸‹å‡ ç§æƒ…å†µä¼šè°ƒç”¨è¯¥å‡½æ•°ï¼š\nstream ç¬¬ä¸€æ¬¡è¢«ç§»åŠ¨å‡º ready_list å¹¶ä¸”å°†è¢«æ’å…¥åˆ° active_streams. stream å®Œæˆäº†ä¸€ä¸ªé€šä¿¡é˜¶æ®µå¹¶ä¸”ç­‰å¾…ä¸‹ä¸€ä¸ªé˜¶æ®µã€‚ stream å®Œæˆäº†æ‰€æœ‰çš„é€šä¿¡é˜¶æ®µã€‚ (2-1) åˆ° (2-5) æè¿°äº†è¯¥å‡½æ•°çš„è¡Œä¸º\næŸ¥çœ‹å½“å‰æŒæœ‰ stream çš„é˜Ÿåˆ—: ä»é˜Ÿåˆ—ä¸­åˆ é™¤ StreamBaseline å¯¹è±¡ (æµçš„å®Œæˆé¡ºåºå¯èƒ½ä¸å®ƒä»¬å¼€å§‹æ‰§è¡Œçš„é¡ºåºä¸åŒ)ã€‚\nä¿®æ”¹ StreamBaseline å¯¹è±¡: å·²å®Œæˆçš„é›†åˆé€šä¿¡é˜¶æ®µä» phases_to_go ä¸­å¼¹å‡ºï¼Œmy_current_phase ç°åœ¨æŒ‡å‘ä¸‹ä¸€ä¸ªå¾…æ‰§è¡Œçš„é˜¶æ®µã€‚\nä½¿ç”¨ insert_stream å°† StreamBaseline å¯¹è±¡æ’å…¥åˆ°ä¸‹ä¸€ä¸ªé˜Ÿåˆ—ä¸­ã€‚\nè°ƒç”¨å‡½æ•° notify_stream_removed å‡½æ•°æŸ¥çœ‹å‰ä¸€ä¸ªé˜Ÿåˆ—çš„å¤´éƒ¨ã€‚ stream_pointer æŒ‡å‘é˜Ÿåˆ—ä¸­ç¬¬ä¸€ä¸ªæœªè¿è¡Œçš„ stream (æ ‡è®°ä¸ºè“è‰²)ã€‚è¯¥å‡½æ•°é€šè¿‡è°ƒç”¨ StreamBaseline::init() æ¥å¯åŠ¨ stream çš„ä¸‹ä¸€ä¸ªé˜¶æ®µçš„æ‰§è¡Œã€‚\nä½¿ç”¨ notify_stream_added è§¦å‘æ–°é˜Ÿåˆ—å¤´éƒ¨ stream çš„é€šä¿¡é˜¶æ®µæ‰§è¡Œã€‚\nåœ¨å…¶ä»–æƒ…å†µä¸‹ï¼Œproceed_to_next_vnet_baseline ä¼šæ‰§è¡Œä¸Šè¿°æ­¥éª¤çš„ä¸€éƒ¨åˆ†ã€‚å…·ä½“å¦‚ä¸‹ï¼š\nåˆšä» ready_list ä¸­ç§»é™¤ï¼š\nproceed_to_next.. ä¼šåˆå§‹åŒ– stream (1-2)ï¼Œå°†å…¶æ’å…¥åˆ°ç¬¬ä¸€ä¸ªé˜Ÿåˆ—ä¸­ (1-3)ï¼Œå¹¶è§¦å‘è¯¥é˜Ÿåˆ—å¤´éƒ¨çš„æµæ‰§è¡Œã€‚\nstream å®Œæˆï¼š\nè¯¥å‡½æ•°ä¼šä»ä¹‹å‰çš„é˜Ÿåˆ—ä¸­åˆ é™¤ stream (3-1)ï¼Œå¹¶è§¦å‘ä¹‹å‰é˜Ÿåˆ—å¤´éƒ¨çš„ stream æ‰§è¡Œã€‚æ­¤å¤–ï¼ŒStreamBaseline å¯¹è±¡ä¼šè¢«åˆ é™¤ï¼Œå¹¶è°ƒç”¨ notify_stream_finishedï¼Œä»¥é€šçŸ¥ Sys å¯¹è±¡ stream å·²ç»ç»“æŸ (3-6)\nCollective Implementation Overview of Collective Implementation æ¨¡æ‹Ÿå™¨å°†é›†ä½“é€šä¿¡åˆ†è§£ä¸ºå‘é€å’Œæ¥æ”¶æ¶ˆæ¯çš„æ–¹å¼æœ‰ä¸¤ç§ã€‚ç›®å‰æœ€å¸¸ç”¨çš„æ–¹æ³•æ˜¯æ¨¡æ‹Ÿå™¨å®ç°ä¸€ç»„é¢„å®šä¹‰çš„å¸¸è§ç®—æ³• (ä¾‹å¦‚ Ringã€DoubleBinaryã€HalvingDoubling ç­‰)ã€‚è¿™ç§â€œåŸç”Ÿâ€å®ç°é€»è¾‘ä½äºæ¨¡æ‹Ÿå™¨çš„ä»£ç åº“ä¸­ï¼Œå…è®¸ç”¨æˆ·å¿«é€Ÿæ¢ç´¢ä¸€ç»„é¢„å®šä¹‰çš„ç®—æ³•ã€‚\nè‡ª 2024 å¹´ 8 æœˆä»¥æ¥ï¼ŒASTRA-sim æ”¯æŒäº†ä¸€ç§æ–°çš„é›†åˆé€šä¿¡ç®—æ³•è¡¨ç¤ºæ–¹å¼ã€‚System å±‚é€šè¿‡æš´éœ²ä¸€ä¸ªé›†ä½“ APIï¼Œå¯ä»¥æ¥æ”¶ä»»æ„é›†ä½“ç®—æ³•çš„å®šä¹‰ã€‚\nè¿™ä¸¤ç§æ–¹æ³•éƒ½æ˜¯å¯¹ CollectivePhase::Algorithm å¯¹è±¡çš„å®ç°ï¼Œè¯¥å¯¹è±¡æ˜¯ System å±‚ä¸­çš„è°ƒåº¦å•å…ƒ. generate_collective_phase ä¼šæ ¹æ®ä¸åŒçš„ç®—æ³•åœ¨åˆ›å»º CollectivePhase çš„æ—¶å€™ä¼ å…¥å¯¹åº”çš„ Algorithm.\nASTRA-Sim Native Implementation ç›¸å…³çš„å®ç°éƒ½ä½äºè¯¥æ–‡ä»¶å¤¹ä¸‹, naive å®ç°çš„é™åˆ¶æ˜¯å½“éœ€è¦æ¨¡æ‹Ÿä¸€ä¸ªæ–°çš„é›†åˆé€šä¿¡ç®—æ³•æ—¶ç®—æ³•ï¼Œå¿…é¡»å®ç°æ•´ä¸ªé›†åˆï¼Ÿéšç€ä¸è§„åˆ™é›†åˆé€šä¿¡ (å¦‚ TACOS(Topology Aware CollectiveS), MSCCLang(åŸºäº DSL)) ä¸­å·¥ä½œçš„å¢åŠ ï¼Œå¿«é€Ÿæ¨¡æ‹Ÿå’Œè¿­ä»£å„ç§ç®—æ³•çš„éœ€æ±‚å˜å¾—è¶Šæ¥è¶Šå¤šã€‚\nChakra Based Arbitrary Definition Through Collective API å› æ­¤ä¸€ä¸ªæ–°çš„ APæ¥æ¥å—ä»»ä½•é›†åˆé€šä¿¡ç®—æ³•çš„å®šä¹‰ï¼Œè€Œä¸å±€é™äºé¢„å®šä¹‰çš„è§„åˆ™é€šä¿¡æ¨¡å¼ã€‚å¯¹äºé€šä¿¡è¡¨ç¤ºï¼Œä½¿ç”¨ Chakra ET æ¨¡å¼ä½œä¸ºå•ç‹¬çš„å›¾ã€‚å°†é›†åˆé€šä¿¡ç®—æ³•è¡¨ç¤ºä¸ºChakra ET æ¨¡å¼ä¸­ COMM_SENDï¼ŒCOMM_RECV èŠ‚ç‚¹çš„å›¾ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒSystem å±‚ä¸æ˜¯å°†é›†åˆé€šä¿¡åˆ†è§£ä¸ºå‘é€å’Œæ¥æ”¶æ¶ˆæ¯ï¼Œè€Œæ˜¯ç®€å•åœ°éµå¾ª Chakra å›¾ä¸­å·²ç»è¡¨ç¤ºçš„åˆ†è§£ã€‚ç”±äºå·²ç»ä½¿ç”¨ Chakra ET æ¥è¡¨ç¤º workloadï¼Œä½¿ç”¨ Chakra ET æ¥é¢å¤–å®šä¹‰é›†åˆé€šä¿¡ç®—æ³•æä¾›äº†ä¸€ç§è½»æ¾ç®€å•çš„æ–¹å¼æ¥éå†æ•´ä¸ªå›¾ã€‚\nå¦‚ä¸Šå›¾æ‰€ç¤ºå½“ workload å±‚å‘å‡º AllReduce é›†ä½“æ“ä½œæ—¶ï¼ŒSystem å±‚ä¸ä¼šè¿è¡Œæ¨¡æ‹Ÿå™¨ä»£ç åº“ä¸­å·²æœ‰çš„åŸç”Ÿå®ç°é€»è¾‘ï¼Œè€Œæ˜¯ä¼šéå†é€šè¿‡ API æä¾›çš„ Chakra ETï¼Œè¯¥ ET è¡¨ç¤ºé›†åˆé€šä¿¡ç®—æ³•ã€‚éœ€è¦æ³¨æ„ workload Chakra å›¾å’Œé›†åˆé€šä¿¡ç®—æ³•çš„ Chakra å›¾æ˜¯è§£è€¦çš„ï¼Œå¹¶é€šè¿‡ä¸åŒçš„è¾“å…¥ç‚¹æä¾›ã€‚æœ€ç»ˆï¼Œasytra-sim æ¨¡æ‹Ÿå™¨ä¼šå°†é€šä¿¡èŠ‚ç‚¹æ›¿æ¢ä¸ºé›†ä½“å®ç°ã€‚\nInput Files for Collective API ASTRA-sim Native // ... \"active-chunks-per-dimension\": 1, \"all-reduce-implementation\": [\"ring\"], \"all-gather-implementation\": [\"ring\", \"doubleBinaryTree\"], \"all-to-all-implementation\": [\"ring\", \"doubleBinaryTree\", \"halvingDoubling\"], // ... all-*-implementation æŒ‡å®šäº†æ¨¡æ‹Ÿå™¨å°†å¦‚ä½•å°†ç»™å®šçš„é›†åˆé€šä¿¡åˆ†è§£ä¸ºå‘é€å’Œæ¥æ”¶æ¶ˆæ¯ã€‚All-Gather æ“ä½œåˆ—è¡¨ä¸­çš„ä¸¤ä¸ªæ¡ç›®è¡¨ç¤ºæ¨¡æ‹Ÿå™¨å°†æŒ‰ä¸¤ä¸ªç»´åº¦åˆ†è§£ â€”â€”ç¬¬ä¸€ä¸ªç»´åº¦ä½¿ç”¨ Ring ç®—æ³•ï¼Œç¬¬äºŒä¸ªç»´åº¦ä½¿ç”¨ doubleBinaryTree ç®—æ³•ã€‚\nNative Implementation Requires That the Dimensions for Collective Algorithms Are Same Across All Collectives.\nWarning\nNative å®ç°è¦æ±‚æ‰€æœ‰é›†ä½“æ“ä½œçš„ç»´åº¦å¿…é¡»ç›¸åŒã€‚æ¢å¥è¯è¯´ï¼Œå¦‚æœä¸€ä¸ªé›†åˆé€šä¿¡ç®—æ³•è¢«å®šä¹‰ä¸ºäºŒç»´çš„ï¼Œé‚£ä¹ˆå…¶ä»–é›†åˆé€šä¿¡ç®—æ³•ä¹Ÿå¿…é¡»æ˜¯äºŒç»´æ“ä½œã€‚ä¸Šè¿°åªæ˜¯ä¸€ä¸ªä¾‹å­ã€‚\nCollective API // ... \"active-chunks-per-dimension\": 1, \"all-reduce-implementation-chakra\": [\"/app/hoti2024/demo5/inputs/custom_ring\"], // ... éœ€è¦æ³¨æ„è¿™é‡Œè¦ä½¿ç”¨ all-*-implementation-chakraï¼Œè€Œä¸æ˜¯ all-*-implementation. å¦å¤– Chakra ET æ–‡ä»¶ä¸ä¼ é€’ç»™ workload å±‚çš„æ–‡ä»¶æ˜¯ä¸åŒçš„ï¼Œæ¯ä¸€é¡¹çš„å€¼æ˜¯ Chakra ET æ–‡ä»¶çš„ç»å¯¹è·¯å¾„ï¼Œä¸åŒ…æ‹¬æœ€åçš„ {rank}.et å­—ç¬¦ä¸² (ç±»ä¼¼äº Workload å±‚è¾“å…¥)ã€‚æ­¤å¤–ï¼Œå³ä½¿æœ‰è®¸å¤šç»´åº¦ï¼Œåˆ—è¡¨ä¹Ÿåªæ¥å—ä¸€ä¸ªå€¼ã€‚è¿™æ˜¯å› ä¸ºè·¨ç»´åº¦é€šä¿¡çš„æ¦‚å¿µå·²ç»åŒ…å«åœ¨ ET ä¸­ã€‚\nCollective API\rå‚è€ƒè¯¥ä»“åº“å®ç°\rNetwork Backend Analytical Network Backend Analytical Network æ¨¡æ‹Ÿå™¨é€šè¿‡æ•°å­¦æ–¹ç¨‹æ¨¡æ‹Ÿæ‰€æœ‰ç½‘ç»œè¡Œä¸ºã€‚å› æ­¤ï¼Œè¯¥åç«¯æœ€é€‚åˆäºå¤§è§„æ¨¡åˆ†å¸ƒå¼å¹³å°çš„å»ºæ¨¡å’Œä»¿çœŸã€‚ç›®å‰æ”¯æŒä¸¤ç§åˆ†ææ¨¡å¼\ncongestion_unaware analytical network simulator congestion_aware analytical network simulator TTopology Analytical Network æ”¯æŒä¸‰ç§æ‹“æ‰‘ç»“æ„: Ring, FullConnected, Switch. å¹¶ä¸”å¯ä»¥å †å æ¥è¡¨ç¤ºå¤šç»´ç½‘ç»œã€‚\nBasic Network Building Block\ntopology: [ Ring, Switch ] # 2D topology topology: [ Ring, Ring, Ring ] # 3D topology Example of 2D \u0026 3D Topologies\nNPUs Count æŒ‡å®šäº†æ¯ä¸ªç»´åº¦ä¸Šçš„è®¾å¤‡æ•°ç›®\nnpus_count: [ 5 ] # 5 NPUs npus_count: [ 4, 2 ] # 4 Ã— 2 = 8 NPUs npus_count: [ 4, 2, 2 ] # 4 Ã— 2 Ã— 2 = 16 NPUs NPUs Count Example\nBandwidth \u0026 Latency latency å®šä¹‰äº†æ¯æ¡å•å‘é“¾è·¯çš„å»¶è¿Ÿ (ns). bandwidth å®šä¹‰äº†æ¯æ¡å•å‘é“¾è·¯çš„å¸¦å®½ (GB/s).\nNote\n$1 GB = 2^{30} B$ and $1 s = 10^9 ns$\nns3 backend ä¸‹é¢æ˜¯ç”¨ ns3 åç«¯è¿›è¡Œæ–¹é’ˆçš„ä¸€ä¸ªæ‰§è¡Œå‘½ä»¤ã€‚è¿™é‡Œä½¿ç”¨äº† --network-backend å’Œ --logical-topology è¿™ä¸¤ä¸ªå‚æ•°ã€‚éœ€è¦è¯´æ˜çš„æ˜¯ï¼ŒAnalytical Backend ä¸­ä»…ä½¿ç”¨äº†--network-backend å‚æ•°ï¼Œè¿™æ˜¯å› ä¸ºåˆ†æå‹åç«¯çš„é€»è¾‘æ‹“æ‰‘ä¸ç‰©ç†æ‹“æ‰‘æ˜¯ç›¸åŒçš„ï¼Œè€Œ ns3 åˆ™å…è®¸æˆ‘ä»¬å°†é€»è¾‘æ‹“æ‰‘ä¸ç‰©ç†æ‹“æ‰‘åˆ†ç¦»ã€‚\n# {NS3_DIR} is the directory of the ns-3 backend. That is, '{ASTRA_SIM_ROOT_DIRECTORY}/extern/network_backend/ns-3' cd \"${NS3_DIR}/build/scratch\" ./ns3.42-AstraSimNetwork-default \\ --workload-configuration=\"${SCRIPT_DIR:?}\"/../../extern/graph_frontend/chakra/one_comm_coll_node_allgather \\ --system-configuration=\"${SCRIPT_DIR:?}\"/../../inputs/system/Switch.json \\ --network-configuration=\"../../../ns-3/scratch/config/config.txt\" \\ --remote-memory-configuration=\"${SCRIPT_DIR:?}\"/../../inputs/remote_memory/analytical/no_memory_expansion.json \\ --logical-topology-configuration=\"${SCRIPT_DIR:?}\"/../../inputs/network/ns3/sample_8nodes_1D.json \\ --comm-group-configuration=\\\"empty\\\" Overview of Trace CollectionÂ â†©ï¸\n",
  "wordCount" : "6842",
  "inLanguage": "en",
  "datePublished": "2025-06-09T13:34:39+08:00",
  "dateModified": "2025-06-13T15:12:24+08:00",
  "author":[{
    "@type": "Person",
    "name": "WITHER"
  }],
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "http://localhost:1313/blogs/astra-sim/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "WITHER",
    "logo": {
      "@type": "ImageObject",
      "url": "http://localhost:1313/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="WITHER (Alt + H)">WITHER</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
                <ul class="lang-switch"><li>|</li>
                    <li>
                        <a href="http://localhost:1313/zh/" title="ç®€ä½“ä¸­æ–‡"
                            aria-label="ç®€ä½“ä¸­æ–‡">ç®€ä½“ä¸­æ–‡</a>
                    </li>
                </ul>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:1313/" title="ğŸ  Home">
                    <span>ğŸ  Home</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/about_me/" title="ğŸ™‹ğŸ»â€â™‚ï¸ Me">
                    <span>ğŸ™‹ğŸ»â€â™‚ï¸ Me</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/blogs/" title="ğŸ“š Blogs">
                    <span>ğŸ“š Blogs</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/categories/" title="ğŸ§© Categories">
                    <span>ğŸ§© Categories</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/tags/" title="ğŸ”– Tags">
                    <span>ğŸ”– Tags</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/archives/" title="â± Archive">
                    <span>â± Archive</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/search/" title="ğŸ” Search (Alt &#43; /)" accesskey=/>
                    <span>ğŸ” Search</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/friends/" title="ğŸ¤ Friends">
                    <span>ğŸ¤ Friends</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="http://localhost:1313/">Home</a>&nbsp;Â»&nbsp;<a href="http://localhost:1313/blogs/">Blogs</a></div>
    <h1 class="post-title entry-hint-parent">
      astra-Sim
    </h1>
    <div class="post-description">
      source code reading of astra-sim
    </div>
    <div class="post-meta"><span title='2025-06-09 13:34:39 +0800 CST'>Jun-09-2025</span>&nbsp;Â·&nbsp;14 min&nbsp;Â·&nbsp;6842 words&nbsp;Â·&nbsp;WITHER

</div>
  </header> <aside id="toc-container" class="toc-container wide">
    <div class="toc">
        <details  open>
            <summary accesskey="c" title="(Alt + C)">
                <span class="details">Table of Contents</span>
            </summary>

            <div class="inner"><ul>
                    <li>
                        <a href="#build-analytical-backend" aria-label="Build Analytical Backend">Build Analytical Backend</a></li>
                    <li>
                        <a href="#build-ns-3-backend" aria-label="Build ns-3 Backend">Build ns-3 Backend</a><ul>
                            
                    <li>
                        <a href="#ns3-configure---enable-mpi" aria-label="./ns3 configure --enable-mpi"><code>./ns3 configure --enable-mpi</code></a></li>
                    <li>
                        <a href="#ns3-build-astrasimnetwork--j-12" aria-label="./ns3 build AstraSimNetwork -j 12"><code>./ns3 build AstraSimNetwork -j 12</code></a></li></ul>
                    </li>
                    <li>
                        <a href="#error-when-building-ns-3" aria-label="Error When Building ns-3">Error When Building ns-3</a><ul>
                            
                    <li>
                        <a href="#call-of-overloaded-format-is-ambiguous-" aria-label="call of overloaded â€˜format(&hellip;)â€™ is ambiguous âŒ">call of overloaded â€˜format(&hellip;)â€™ is ambiguous âŒ</a><ul>
                            
                    <li>
                        <a href="#%e9%97%ae%e9%a2%98%e8%af%8a%e6%96%ad-" aria-label="é—®é¢˜è¯Šæ–­ ğŸ©º">é—®é¢˜è¯Šæ–­ ğŸ©º</a></li>
                    <li>
                        <a href="#%e5%85%b3%e4%ba%8e-using-fmtformat-%e4%b8%ba%e4%bd%95%e4%bb%8d%e7%84%b6%e6%97%a0%e6%95%88%e7%9a%84%e8%a7%a3%e9%87%8a" aria-label="å…³äº using fmt::format; ä¸ºä½•ä»ç„¶æ— æ•ˆçš„è§£é‡Š">å…³äº <code>using fmt::format;</code> ä¸ºä½•ä»ç„¶æ— æ•ˆçš„è§£é‡Š</a></li>
                    <li>
                        <a href="#%e7%bb%93%e8%ae%ba%e4%b8%8e%e6%9c%80%e7%bb%88%e8%a7%a3%e5%86%b3%e6%96%b9%e6%a1%88-" aria-label="ç»“è®ºä¸æœ€ç»ˆè§£å†³æ–¹æ¡ˆ âœ…">ç»“è®ºä¸æœ€ç»ˆè§£å†³æ–¹æ¡ˆ âœ…</a></li></ul>
                    </li></ul>
                    </li>
                    <li>
                        <a href="#runing-arguments" aria-label="Runing Arguments">Runing Arguments</a><ul>
                            
                    <li>
                        <a href="#workload_config" aria-label="WORKLOAD_CONFIG">WORKLOAD_CONFIG</a><ul>
                            
                    <li>
                        <a href="#generate-execution-trace" aria-label="Generate Execution Trace">Generate Execution Trace</a></li>
                    <li>
                        <a href="#using-et-converter" aria-label="Using ET Converter">Using ET Converter</a></li>
                    <li>
                        <a href="#enable-communicator-groups" aria-label="Enable Communicator Groups">Enable Communicator Groups</a></li></ul>
                    </li>
                    <li>
                        <a href="#system_config" aria-label="SYSTEM_CONFIG">SYSTEM_CONFIG</a></li></ul>
                    </li>
                    <li>
                        <a href="#system-layer" aria-label="System Layer">System Layer</a><ul>
                            
                    <li>
                        <a href="#collective-scheduler" aria-label="Collective Scheduler">Collective Scheduler</a></li>
                    <li>
                        <a href="#collective-implementation" aria-label="Collective Implementation">Collective Implementation</a><ul>
                            
                    <li>
                        <a href="#astra-sim-native-implementation" aria-label="ASTRA-Sim Native Implementation">ASTRA-Sim Native Implementation</a></li>
                    <li>
                        <a href="#chakra-based-arbitrary-definition-through-collective-api" aria-label="Chakra Based Arbitrary Definition Through Collective API">Chakra Based Arbitrary Definition Through Collective API</a></li></ul>
                    </li>
                    <li>
                        <a href="#input-files-for-collective-api" aria-label="Input Files for Collective API">Input Files for Collective API</a><ul>
                            
                    <li>
                        <a href="#astra-sim-native" aria-label="ASTRA-sim Native">ASTRA-sim Native</a></li>
                    <li>
                        <a href="#collective-api" aria-label="Collective API">Collective API</a></li></ul>
                    </li></ul>
                    </li>
                    <li>
                        <a href="#network-backend" aria-label="Network Backend">Network Backend</a><ul>
                            
                    <li>
                        <a href="#analytical-network-backend" aria-label="Analytical Network Backend">Analytical Network Backend</a></li>
                    <li>
                        <a href="#ns3-backend" aria-label="ns3 backend">ns3 backend</a>
                    </li>
                </ul>
                </li>
                </ul>
            </div>
        </details>
    </div>
</aside>
<script>
    let activeElement;
    let elements;
    
    document.addEventListener('DOMContentLoaded', function (event) {
        checkTocPosition();
    
        elements = document.querySelectorAll('h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]');
        if (elements.length > 0) {
            
            activeElement = elements[0];
            const id = encodeURI(activeElement.getAttribute('id')).toLowerCase();
            document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
        }
    
        
        const topLink = document.getElementById('top-link');
        if (topLink) {
            topLink.addEventListener('click', (event) => {
                
                event.preventDefault();
    
                
                window.scrollTo({ top: 0, behavior: 'smooth' });
            });
        }
    }, false);
    
    window.addEventListener('resize', function(event) {
        checkTocPosition();
    }, false);
    
    window.addEventListener('scroll', () => {
        
        const scrollPosition = window.pageYOffset || document.documentElement.scrollTop;
    
        
        if (scrollPosition === 0) {
            return;
        }
    
        
        if (elements && elements.length > 0) {
            
            activeElement = Array.from(elements).find((element) => {
                if ((getOffsetTop(element) - scrollPosition) > 0 && 
                    (getOffsetTop(element) - scrollPosition) < window.innerHeight / 2) {
                    return element;
                }
            }) || activeElement;
    
            elements.forEach(element => {
                const id = encodeURI(element.getAttribute('id')).toLowerCase();
                const tocLink = document.querySelector(`.inner ul li a[href="#${id}"]`);
                if (element === activeElement){
                    tocLink.classList.add('active');
    
                    
                    const tocContainer = document.querySelector('.toc .inner');
                    const linkOffsetTop = tocLink.offsetTop;
                    const containerHeight = tocContainer.clientHeight;
                    const linkHeight = tocLink.clientHeight;
    
                    
                    const scrollPosition = linkOffsetTop - (containerHeight / 2) + (linkHeight / 2);
                    tocContainer.scrollTo({ top: scrollPosition, behavior: 'smooth' });
                } else {
                    tocLink.classList.remove('active');
                }
            });
        }
    }, false);
    
    const main = parseInt(getComputedStyle(document.body).getPropertyValue('--article-width'), 10);
    const toc = parseInt(getComputedStyle(document.body).getPropertyValue('--toc-width'), 10);
    const gap = parseInt(getComputedStyle(document.body).getPropertyValue('--gap'), 10);
    
    function checkTocPosition() {
        const width = document.body.scrollWidth;
    
        if (width - main - (toc * 2) - (gap * 4) > 0) {
            document.getElementById("toc-container").classList.add("wide");
        } else {
            document.getElementById("toc-container").classList.remove("wide");
        }
    }
    
    function getOffsetTop(element) {
        if (!element.getClientRects().length) {
            return 0;
        }
        let rect = element.getBoundingClientRect();
        let win = element.ownerDocument.defaultView;
        return rect.top + win.pageYOffset;   
    }
    
</script>

  <div class="post-content"><h1 id="build-analytical-backend">Build Analytical Backend<a hidden class="anchor" aria-hidden="true" href="#build-analytical-backend">#</a></h1>
<p><code>build.sh</code> è„šæœ¬æ˜¯æ„å»ºè¿‡ç¨‹çš„é«˜çº§æ§åˆ¶å™¨ã€‚å…¶æ ¸å¿ƒèŒè´£æ˜¯è§£æç”¨æˆ·æ„å›¾ï¼Œæ‰§è¡Œé¢„æ„å»ºæ­¥éª¤ï¼Œå¹¶ä»¥æ­£ç¡®çš„å‚æ•°è°ƒç”¨åº•å±‚çš„ CMake å·¥å…·é“¾ã€‚</p>
<ol>
<li>
<p><strong>é€‰é¡¹è§£æ</strong>: è„šæœ¬é€šè¿‡ <code>getopts</code> å¤„ç†ä»¥ä¸‹å‘½ä»¤è¡Œæ ‡å¿—ï¼š</p>
<ul>
<li><code>-t &lt;target&gt;</code>: æŒ‡å®šç¼–è¯‘ç›®æ ‡ã€‚æœ‰æ•ˆå€¼ä¸º <code>all</code>, <code>congestion_unaware</code>, <code>congestion_aware</code>ã€‚æ­¤å€¼å°†ä½œä¸ºå˜é‡ä¼ é€’ç»™ CMakeã€‚</li>
<li><code>-l</code>: è§¦å‘æ¸…ç† (<code>cleanup</code>) æµç¨‹ï¼Œåˆ é™¤æ‰€æœ‰æ„å»ºäº§ç‰©å¹¶ç»ˆæ­¢è„šæœ¬ã€‚</li>
<li><code>-d</code>: å¯ç”¨è°ƒè¯• (<code>Debug</code>) æ¨¡å¼è¿›è¡Œç¼–è¯‘ã€‚</li>
</ul>
</li>
<li>
<p><strong>ç¯å¢ƒå‡†å¤‡ (<code>setup</code>, <code>compile_chakra_et</code>)</strong>:</p>
<ul>
<li><code>setup</code> å‡½æ•°è´Ÿè´£åˆ›å»ºç”¨äºå­˜æ”¾ä¸­é—´æ–‡ä»¶å’Œæœ€ç»ˆäº§ç‰©çš„ <code>build</code> ç›®å½•ï¼Œç¡®ä¿æºç æ ‘çš„æ¸…æ´ã€‚åŒæ—¶ï¼Œå®ƒä¼šæ ¹æ®ç³»ç»Ÿæ ¸å¿ƒæ•°è®¾ç½®ä¸€ä¸ªä¸Šé™ä¸º 16 çš„å¹¶å‘ç¼–è¯‘çº¿ç¨‹æ•°ï¼Œä»¥ä¼˜åŒ–ç¼–è¯‘æ•ˆç‡ã€‚</li>
<li><code>compile_chakra_et</code> å‡½æ•°è´Ÿè´£å¤„ç† <code>et_def.proto</code> è¿™ä¸€ Protobuf ä¾èµ–ã€‚å®ƒæ£€æŸ¥ç›®æ ‡æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œè‹¥ä¸å­˜åœ¨ï¼Œåˆ™è°ƒç”¨ <code>protoc</code> ç¼–è¯‘å™¨ç”Ÿæˆç›¸åº”çš„ C++ å’Œ Python æºç ã€‚</li>
</ul>
</li>
<li>
<p><strong>æ„å»ºæ‰§è¡Œ (<code>compile_astrasim_analytical</code>, <code>compile_astrasim_analytical_as_debug</code>)</strong>:</p>
<ul>
<li>è¿™ä¸¤ä¸ªå‡½æ•°æ˜¯è„šæœ¬ä¸ CMake äº¤äº’çš„æ ¸å¿ƒã€‚å®ƒä»¬æ ¹æ®ç”¨æˆ·æ˜¯å¦æŒ‡å®š <code>-d</code> æ ‡å¿—ï¼Œå†³å®šæ˜¯æ‰§è¡Œæ ‡å‡† <code>Release</code> æ„å»ºè¿˜æ˜¯ <code>Debug</code> æ„å»ºã€‚å…³é”®åœ¨äºå®ƒä»¬ä¼šå°†ç”¨æˆ·æŒ‡å®šçš„ <code>build_target</code> ä½œä¸º <code>-DBUILDTARGET</code> å‚æ•°ä¼ é€’ç»™ CMakeã€‚</li>
</ul>
</li>
<li>
<p><strong>åå¤„ç† (<code>create_symlink_*</code>)</strong>:</p>
<ul>
<li>ç¼–è¯‘å®Œæˆåï¼Œ<code>create_symlink_congestion_unaware</code> å’Œ <code>create_symlink_congestion_aware</code> ç­‰å‡½æ•°ä¼šä¸ºç”Ÿæˆçš„äºŒè¿›åˆ¶æ–‡ä»¶åˆ›å»ºç¬¦å·é“¾æ¥ã€‚æ­¤ä¸¾æ—¨åœ¨ç»´æŒå¯¹æ—§æ–‡ä»¶è·¯å¾„çš„å‘åå…¼å®¹æ€§ã€‚</li>
</ul>
</li>
</ol>
<hr>
<p><code>CMakeLists.txt</code> æ–‡ä»¶æ˜¯é¡¹ç›®çš„æ„å»ºè“å›¾ï¼Œå®ƒå‘ CMake é˜è¿°äº†é¡¹ç›®çš„ç»“æ„ã€ä¾èµ–å…³ç³»ä»¥åŠç¼–è¯‘è§„åˆ™ã€‚</p>
<ol>
<li>
<p><strong>ç¼–è¯‘ç¯å¢ƒè®¾å®š</strong>:</p>
<ul>
<li><code>cmake_minimum_required(VERSION 3.15)</code>: è§„å®šäº†è¿è¡Œæ­¤é…ç½®æ‰€éœ€çš„æœ€ä½ CMake ç‰ˆæœ¬ã€‚</li>
<li><code>set(CMAKE_CXX_STANDARD 17)</code> å’Œ <code>set(CMAKE_CXX_STANDARD_REQUIRED ON)</code>: å¼ºåˆ¶é¡¹ç›®å¿…é¡»åœ¨æ”¯æŒ C++17 æ ‡å‡†çš„ç¼–è¯‘ç¯å¢ƒä¸­æ„å»ºã€‚</li>
</ul>
</li>
<li>
<p><strong>ç¼–è¯‘æ ‡å¿— (Compiler Flags)</strong>:</p>
<ul>
<li>æ­¤æ–‡ä»¶ä¸ºä¸åŒçš„æ„å»ºç±»å‹ï¼ˆ<code>CMAKE_BUILD_TYPE</code>ï¼‰å®šä¹‰äº†ä¸åŒçš„ç¼–è¯‘å™¨æ ‡å¿—ã€‚</li>
<li><strong><code>Release</code></strong> (é»˜è®¤æ¨¡å¼): <code>set(CMAKE_CXX_FLAGS_RELEASE &quot;-O3&quot;)</code> æŒ‡ç¤ºç¼–è¯‘å™¨è¿›è¡Œé«˜ç­‰çº§ä¼˜åŒ–ï¼Œä»¥è¿½æ±‚æœ€å¤§åŒ–ç¨‹åºæ€§èƒ½ã€‚</li>
<li><strong><code>Debug</code></strong>: <code>set(CMAKE_CXX_FLAGS_DEBUG &quot;...&quot;)</code> åŒ…å«ä¸€ç³»åˆ—ç”¨äºè°ƒè¯•çš„æ ‡å¿—ï¼š
<ul>
<li><code>-O0</code>: å…³é—­æ‰€æœ‰ä¼˜åŒ–ï¼Œç¡®ä¿ç¼–è¯‘åçš„ä»£ç ä¸æºç è¡Œä¸ºä¸€è‡´ã€‚</li>
<li><code>-g</code>: åœ¨å¯æ‰§è¡Œæ–‡ä»¶ä¸­åŒ…å«è°ƒè¯•ç¬¦å·ï¼Œè¿™æ˜¯ GDB ç­‰è°ƒè¯•å™¨å·¥ä½œçš„å‰æã€‚</li>
<li><code>-fsanitize=address,undefined,leak</code>: å¯ç”¨ AddressSanitizerã€UndefinedBehaviorSanitizer å’Œ LeakSanitizerã€‚è¿™äº›æ˜¯å¼ºå¤§çš„è¿è¡Œæ—¶è¯Šæ–­å·¥å…·ï¼Œç”¨äºæ•è·å†…å­˜è®¿é—®é”™è¯¯ã€æœªå®šä¹‰è¡Œä¸ºåŠå†…å­˜æ³„æ¼ã€‚</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>é¡¹ç›®ç»“æ„ä¸ä¾èµ–</strong>:</p>
<ul>
<li><code>project(AstraSim_Analytical)</code>: å£°æ˜é¡¹ç›®åç§°ã€‚</li>
<li><code>add_subdirectory(...)</code>: æ­¤æŒ‡ä»¤æ˜¯ç»„ç»‡é¡¹ç›®çš„å…³é”®ã€‚å®ƒå°† <code>AstraSim</code> æ ¸å¿ƒåº“ã€<code>Analytical</code> ç½‘ç»œåç«¯å’Œ <code>AstraSim_Analytical</code> å‰ç«¯ç­‰å¤šä¸ªå­æ¨¡å—çº³å…¥æ„å»ºè¿‡ç¨‹ã€‚</li>
</ul>
</li>
<li>
<p><strong>ç”¨æˆ·è‡ªå®šä¹‰é€‰é¡¹</strong>:</p>
<ul>
<li><code>set(BUILDTARGET &quot;all&quot; CACHE STRING ...)</code>: æ­¤è¡Œå®šä¹‰äº†ä¸€ä¸ªåä¸º <code>BUILDTARGET</code> çš„å¯ç¼“å­˜å˜é‡ã€‚è¿™ä½¿å¾—ç”¨æˆ·å¯ä»¥é€šè¿‡ <code>cmake -D</code> å‘½ä»¤ä»å¤–éƒ¨æ³¨å…¥è¯¥å˜é‡çš„å€¼ã€‚æ­¤å˜é‡éšåä¼šè¢«å­ç›®å½•ä¸­çš„ <code>CMakeLists.txt</code> æ–‡ä»¶ç”¨æ¥å®ç°æ¡ä»¶ç¼–è¯‘ã€‚</li>
</ul>
</li>
</ol>
<h1 id="build-ns-3-backend">Build ns-3 Backend<a hidden class="anchor" aria-hidden="true" href="#build-ns-3-backend">#</a></h1>
<p>æ„å»ºå‘½ä»¤ä¸º <code>./build/astra_ns3/build.sh -c</code>ï¼Œä»–ä¼šæ‰§è¡Œè¯¥è„šæœ¬é‡Œçš„ compile å‡½æ•°</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="k">function</span> compile <span class="o">{</span>
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> <span class="s2">&#34;</span><span class="si">${</span><span class="nv">NS3_DIR</span><span class="si">}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">./ns3 configure --enable-mpi
</span></span><span class="line"><span class="cl">./ns3 build AstraSimNetwork -j <span class="m">12</span>
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> <span class="s2">&#34;</span><span class="si">${</span><span class="nv">SCRIPT_DIR</span><span class="p">:?</span><span class="si">}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="ns3-configure---enable-mpi"><code>./ns3 configure --enable-mpi</code><a hidden class="anchor" aria-hidden="true" href="#ns3-configure---enable-mpi">#</a></h2>
<ol>
<li>å‚æ•°è§£æ (<code>parse_args</code>): è„šæœ¬çš„ <code>argparse</code> æ¨¡å—ä¼šè¯†åˆ«å‡º <code>configure</code> å­å‘½ä»¤å’Œ <code>--enable-mpi</code> é€‰é¡¹ã€‚<code>--enable-mpi</code> æ˜¯ä¸€ä¸ªé¢„å®šä¹‰çš„&quot;On-Off&quot;é€‰é¡¹ï¼Œç”¨äºæ§åˆ¶ MPI (Message Passing Interface) åˆ†å¸ƒå¼ä»¿çœŸåŠŸèƒ½çš„æ”¯æŒã€‚</li>
<li>è¿›å…¥é…ç½®æ­¥éª¤ (<code>configuration_step</code>): ç”±äºæ£€æµ‹åˆ° configure å‘½ä»¤ï¼Œè„šæœ¬ä¼šè°ƒç”¨ <code>configuration_step</code> å‡½æ•°ã€‚</li>
<li>è°ƒç”¨ CMake (<code>configure_cmake</code>): <code>configuration_step</code> å‡½æ•°å†…éƒ¨ä¼šè°ƒç”¨ <code>configure_cmake</code>. è¿™ä¸ªå‡½æ•°æ˜¯ä¼šåŠ¨æ€åœ°æ„å»ºä¸€ä¸ª cmake å‘½ä»¤ã€‚
<ul>
<li>å®ƒä¼šæ£€æµ‹åˆ° <code>--enable-mpi</code> é€‰é¡¹ï¼Œå¹¶é€šè¿‡ <code>on_off_condition</code> å‡½æ•°å°†å…¶è½¬æ¢ä¸º CMake å˜é‡ <code>-DNS3_MPI=ON</code>.</li>
<li>æœ€ç»ˆç»„è£…å‡ºçš„å‘½ä»¤ä¸ºä¸º <code>cmake -S . -B cmake-cache -G &quot;Unix Makefiles&quot; -DCMAKE_BUILD_TYPE=default -DNS3_ASSERT=ON -DNS3_LOG=ON -DNS3_WARNINGS_AS_ERRORS=OFF -DNS3_MPI=ON --warn-uninitialized</code></li>
</ul>
</li>
<li>æ‰§è¡Œé…ç½®: è„šæœ¬é€šè¿‡ <code>subprocess.run()</code> æ‰§è¡Œè¿™æ¡ cmake å‘½ä»¤</li>
</ol>
<h2 id="ns3-build-astrasimnetwork--j-12"><code>./ns3 build AstraSimNetwork -j 12</code><a hidden class="anchor" aria-hidden="true" href="#ns3-build-astrasimnetwork--j-12">#</a></h2>
<ol>
<li>å‚æ•°è§£æ (<code>parse_args</code>): è„šæœ¬è¯†åˆ«å‡º <code>build</code> å­å‘½ä»¤ï¼Œç›®æ ‡ <code>AstraSimNetwork</code>ï¼Œä»¥åŠå¹¶è¡Œä»»åŠ¡æ•° <code>-j 12</code>. å‰è€…ä¼šè¢«å­˜å…¥ <code>args.build</code> åˆ—è¡¨ï¼Œåè€…ä¼šè¢«å­˜å…¥ <code>args.jobs</code>.</li>
<li>è¿›å…¥æ„å»ºæ­¥éª¤ (<code>build_step</code>): è„šæœ¬æ£€æµ‹åˆ° <code>build</code> å‘½ä»¤ï¼Œå¹¶è°ƒç”¨ <code>build_step</code> å‡½æ•°ã€‚</li>
<li>è°ƒç”¨ CMake æ„å»º (<code>cmake_build</code>): <code>build_step</code> å‡½æ•°ä¼šéå† <code>args.build</code> åˆ—è¡¨ä¸­çš„æ‰€æœ‰ç›®æ ‡ã€‚åœ¨è¿™é‡Œï¼Œå®ƒä¼šä¸º <code>AstraSimNetwork</code> è¿™ä¸ªç›®æ ‡è°ƒç”¨ <code>cmake_build</code> å‡½æ•°ã€‚
<ul>
<li>cmake_build å‡½æ•°ä¼šç»„è£…å‡ºä¸€æ¡ <code>cmake --build</code> å‘½ä»¤ã€‚</li>
<li>å°†ç›®æ ‡ AstraSimNetwork è½¬æ¢ä¸º <code>--target AstraSimNetwork</code>.</li>
<li>å°†å¹¶è¡Œä»»åŠ¡æ•° 12 è½¬æ¢ä¸º <code>-j 12</code>.</li>
<li>æœ€ç»ˆç»„è£…å‡ºçš„å‘½ä»¤ä¸º <code>cmake --build cmake-cache --target AstraSimNetwork -j 12</code>.</li>
</ul>
</li>
</ol>
<h1 id="error-when-building-ns-3">Error When Building ns-3<a hidden class="anchor" aria-hidden="true" href="#error-when-building-ns-3">#</a></h1>
<h2 id="call-of-overloaded-format-is-ambiguous-">call of overloaded â€˜format(&hellip;)â€™ is ambiguous âŒ<a hidden class="anchor" aria-hidden="true" href="#call-of-overloaded-format-is-ambiguous-">#</a></h2>
<h3 id="é—®é¢˜è¯Šæ–­-">é—®é¢˜è¯Šæ–­ ğŸ©º<a hidden class="anchor" aria-hidden="true" href="#é—®é¢˜è¯Šæ–­-">#</a></h3>
<p>é”™è¯¯ä¿¡æ¯ <code>call of overloaded â€˜format(...)â€™ is ambiguous</code> çš„æ„æ€æ˜¯ï¼Œç¼–è¯‘å™¨åœ¨ä½ çš„ä»£ç ä¸­é‡åˆ°äº†ä¸€ä¸ªåä¸º <code>format</code> çš„å‡½æ•°è°ƒç”¨ï¼Œä½†å®ƒæ‰¾åˆ°äº†å¤šä¸ªåŒåçš„ã€å¹¶ä¸”å‚æ•°ç±»å‹éƒ½èƒ½åŒ¹é…çš„ <code>format</code> å‡½æ•°å®šä¹‰ï¼Œå¯¼è‡´ç¼–è¯‘å™¨ä¸çŸ¥é“è¯¥é€‰æ‹©å“ªä¸€ä¸ªï¼Œå› æ­¤äº§ç”Ÿäº†â€œæ­§ä¹‰â€ï¼ˆambiguousï¼‰ã€‚</p>
<p><strong>è¿™ä¸ªæ­§ä¹‰çš„æ¥æºæ˜¯ï¼š</strong></p>
<ol>
<li><strong><code>std::format</code> (æ¥è‡ª C++20 æ ‡å‡†åº“)</strong>: ä½ çš„é¡¹ç›®å¾ˆå¯èƒ½æ­£åœ¨ä½¿ç”¨æ”¯æŒ C++20 æˆ–æ›´é«˜ç‰ˆæœ¬çš„ç°ä»£ç¼–è¯‘å™¨ï¼ˆå¦‚ GCC 11+ï¼‰ã€‚C++20 æ ‡å‡†åº“å¼•å…¥äº†ä¸€ä¸ªæ–°çš„æ ¼å¼åŒ–å‡½æ•° <code>std::format</code>ã€‚</li>
<li><strong><code>fmt::format</code> (æ¥è‡ª {fmt} åº“)</strong>: <code>spdlog</code> è¿™ä¸ªæ—¥å¿—åº“æ˜¯åŸºäºä¸€ä¸ªéå¸¸æµè¡Œçš„ç¬¬ä¸‰æ–¹æ ¼å¼åŒ–åº“ <code>{fmt}</code> æ„å»ºçš„ã€‚è¿™ä¸ªåº“ä¹Ÿæä¾›äº†ä¸€ä¸ªåŠŸèƒ½å‡ ä¹å®Œå…¨ç›¸åŒçš„ <code>fmt::format</code> å‡½æ•°ã€‚åœ¨ <code>spdlog</code> çš„ä¸Šä¸‹æ–‡ä¸­ï¼Œå®ƒé€šå¸¸å¯ä»¥ç›´æ¥ä»¥ <code>format</code> çš„å½¢å¼è¢«è°ƒç”¨ã€‚</li>
</ol>
<p>å½“ä½ çš„ä»£ç ï¼ˆè¿™é‡Œæ˜¯ <code>spdlog_setup</code> çš„ä¸€éƒ¨åˆ†ï¼‰ç®€å•åœ°è°ƒç”¨ <code>format(...)</code> æ—¶ï¼Œå¦‚æœ C++20 çš„ <code>&lt;format&gt;</code> å¤´æ–‡ä»¶è¢«åŒ…å«ï¼Œç¼–è¯‘å™¨å°±ä¼šåŒæ—¶çœ‹åˆ° <code>std::format</code> å’Œ <code>spdlog</code> å†…éƒ¨çš„ <code>fmt::format</code>ã€‚ç”±äºä¸¤è€…éƒ½èƒ½å¤„ç†å­—ç¬¦ä¸²å­—é¢é‡ (<code>const char[]</code>) å’Œ <code>std::string</code>ï¼Œç¼–è¯‘å™¨æ— æ³•å†³å®šç”¨å“ªä¸ªï¼Œä»è€ŒæŠ¥é”™ã€‚</p>
<hr>
<h3 id="å…³äº-using-fmtformat-ä¸ºä½•ä»ç„¶æ— æ•ˆçš„è§£é‡Š">å…³äº <code>using fmt::format;</code> ä¸ºä½•ä»ç„¶æ— æ•ˆçš„è§£é‡Š<a hidden class="anchor" aria-hidden="true" href="#å…³äº-using-fmtformat-ä¸ºä½•ä»ç„¶æ— æ•ˆçš„è§£é‡Š">#</a></h3>
<p>åŸå› æ˜¯ï¼Œé™¤äº†å¸¸è§„çš„å‘½åç©ºé—´æŸ¥æ‰¾è§„åˆ™ï¼ŒC++ è¿˜æœ‰ä¸€ä¸ªæ›´å¼ºå¤§çš„è§„åˆ™å«åš<strong>å‚æ•°ä¾èµ–æŸ¥æ‰¾ï¼ˆArgument-Dependent Lookup, ADLï¼‰</strong>ï¼Œæœ‰æ—¶ä¹Ÿè¢«ç§°ä¸º Koenig æŸ¥æ‰¾ã€‚</p>
<hr>
<p>æˆ‘ä»¬æ¥æ¢³ç†ä¸€ä¸‹ç¼–è¯‘å™¨åœ¨çœ‹åˆ° <code>format(...)</code> è¿™è¡Œä»£ç æ—¶çš„â€œæ€è€ƒè¿‡ç¨‹â€ï¼š</p>
<ol>
<li>
<p><strong>åœ¨å½“å‰ä½œç”¨åŸŸæŸ¥æ‰¾</strong></p>
<p>ç¼–è¯‘å™¨çœ‹åˆ°äº†ä½ çš„ <code>using fmt::format;</code> å£°æ˜ã€‚å¾ˆå¥½ï¼Œå®ƒåœ¨å½“å‰ä½œç”¨åŸŸé‡Œæ‰¾åˆ°äº†ä¸€ä¸ªå«åš <code>format</code> çš„å‡½æ•°ï¼ˆä¹Ÿå°±æ˜¯ <code>fmt::format</code>ï¼‰ã€‚è¿™æˆä¸ºäº†<strong>å€™é€‰è€… A</strong>ã€‚</p>
</li>
<li>
<p><strong>å‚æ•°ä¾èµ–æŸ¥æ‰¾ (ADL) â€”â€” é—®é¢˜çš„æ ¹æº</strong></p>
<p>æ¥ä¸‹æ¥ï¼Œç¼–è¯‘å™¨ä¼šæ£€æŸ¥ <code>format(...)</code> å‡½æ•°çš„æ‰€æœ‰å‚æ•°ç±»å‹ã€‚åœ¨ä½ çš„é”™è¯¯æ—¥å¿—é‡Œï¼Œæˆ‘ä»¬çœ‹åˆ°äº† <code>const std::string&amp;</code> è¿™æ ·çš„å‚æ•°ã€‚</p>
<ul>
<li>ADL è§„åˆ™è§„å®šï¼šå¦‚æœä¸€ä¸ªå‡½æ•°çš„å‚æ•°æ˜¯æŸä¸ªå‘½åç©ºé—´ <code>N</code> ä¸‹çš„ç±»å‹ï¼ˆæ¯”å¦‚ <code>std::string</code> æ˜¯ <code>std</code> å‘½åç©ºé—´ä¸‹çš„ï¼‰ï¼Œé‚£ä¹ˆç¼–è¯‘å™¨<strong>ä¹Ÿå¿…é¡»</strong>å»é‚£ä¸ªå‘½åç©ºé—´ <code>N</code> (è¿™é‡Œæ˜¯ <code>std</code>) é‡Œé¢å»æŸ¥æ‰¾åŒåçš„å‡½æ•°ã€‚</li>
<li>ç”±äº <code>std::string</code> æ˜¯ <code>std</code> å‘½åç©ºé—´çš„æˆå‘˜ï¼ŒADL è§„åˆ™è¢«è§¦å‘ï¼Œç¼–è¯‘å™¨è‡ªåŠ¨åœ°å» <code>std</code> å‘½åç©ºé—´é‡Œå¯»æ‰¾åä¸º <code>format</code> çš„å‡½æ•°ã€‚</li>
<li>å› ä¸ºä½ ä½¿ç”¨äº† C++20 ç¼–è¯‘å™¨ï¼Œå®ƒåœ¨ <code>std</code> å‘½åç©ºé—´é‡ŒæˆåŠŸæ‰¾åˆ°äº† <code>std::format</code>ã€‚è¿™æˆä¸ºäº†<strong>å€™é€‰è€… B</strong>ã€‚</li>
</ul>
</li>
<li>
<p><strong>äº§ç”Ÿæ­§ä¹‰</strong></p>
<p>ç°åœ¨ç¼–è¯‘å™¨é™·å…¥äº†å›°å¢ƒã€‚å®ƒæ‰‹å¤´æœ‰ä¸¤ä¸ªåŒæ ·åŒ¹é…çš„å€™é€‰å‡½æ•°ï¼š</p>
<ul>
<li><strong>å€™é€‰è€… A</strong>: <code>fmt::format</code> (é€šè¿‡ <code>using</code> å£°æ˜æ‰¾åˆ°)</li>
<li><strong>å€™é€‰è€… B</strong>: <code>std::format</code> (é€šè¿‡ ADL åœ¨å‚æ•°çš„å‘½åç©ºé—´é‡Œæ‰¾åˆ°)</li>
</ul>
<p><code>using</code> å£°æ˜åªæ˜¯å°†ä¸€ä¸ªåå­—å¼•å…¥å½“å‰ä½œç”¨åŸŸï¼Œå®ƒå¹¶**æ²¡æœ‰è¶³å¤Ÿçš„â€œç‰¹æƒâ€**å»å‹åˆ¶ä¸€ä¸ªé€šè¿‡ ADL æ‰¾åˆ°çš„åŒæ ·ä¼˜ç§€çš„å€™é€‰è€…ã€‚å› ä¸ºä¸¤ä¸ªå‡½æ•°éƒ½èƒ½å®Œç¾å¤„ç†ä½ ä¼ å…¥çš„å‚æ•°ï¼Œç¼–è¯‘å™¨æ— æ³•åšå‡ºé€‰æ‹©ï¼Œæ‰€ä»¥å®ƒåªèƒ½æ”¾å¼ƒå¹¶æŠ¥å‘Šâ€œè°ƒç”¨æ˜¯æ¨¡ç³Šçš„ (ambiguous)â€ã€‚</p>
</li>
</ol>
<h3 id="ç»“è®ºä¸æœ€ç»ˆè§£å†³æ–¹æ¡ˆ-">ç»“è®ºä¸æœ€ç»ˆè§£å†³æ–¹æ¡ˆ âœ…<a hidden class="anchor" aria-hidden="true" href="#ç»“è®ºä¸æœ€ç»ˆè§£å†³æ–¹æ¡ˆ-">#</a></h3>
<p>è¿™ä¸ª C++ çš„ç‰¹æ€§æ„å‘³ç€ï¼Œåªè¦ä½ çš„å‡½æ•°å‚æ•°ä¸­åŒ…å«äº† <code>std</code> å‘½åç©ºé—´é‡Œçš„ç±»å‹ï¼ˆå¦‚ <code>std::string</code>, <code>std::vector</code> ç­‰ï¼‰ï¼ŒADL å°±æœ‰å¯èƒ½è¢«è§¦å‘ï¼Œä»è€ŒæŠŠ <code>std</code> é‡Œçš„å‡½æ•°ï¼ˆå¦‚ <code>std::format</code>, <code>std::to_string</code> ç­‰ï¼‰ä¹Ÿæ‹‰å…¥å€™é€‰åˆ—è¡¨ï¼Œé€ æˆæ„æƒ³ä¸åˆ°çš„å†²çªã€‚</p>
<p>å› æ­¤ï¼Œå”¯ä¸€èƒ½ 100% æ¶ˆé™¤æ­§ä¹‰ã€è®©ç¼–è¯‘å™¨åˆ«æ— é€‰æ‹©çš„æ–¹æ³•ï¼Œå°±æ˜¯ä½¿ç”¨<strong>æ˜¾å¼çš„å‘½åç©ºé—´é™å®š</strong>ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="c1">// è¿™æ ·åšï¼Œæ˜¯åœ¨ç›´æ¥å‘Šè¯‰ç¼–è¯‘å™¨ï¼šâ€œåˆ«å»çŒœäº†ï¼Œæˆ‘å°±æ˜¯è¦è°ƒç”¨ fmt å‘½åç©ºé—´é‡Œçš„è¿™ä¸ª formatï¼â€
</span></span></span><span class="line"><span class="cl"><span class="c1">// è¿™ä¼šå®Œå…¨ç»•è¿‡ ADL å’Œå…¶ä»–æŸ¥æ‰¾è§„åˆ™ï¼Œç›´è¾¾ç›®æ ‡ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">fmt</span><span class="o">::</span><span class="n">format</span><span class="p">(...);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="runing-arguments">Runing Arguments<a hidden class="anchor" aria-hidden="true" href="#runing-arguments">#</a></h1>
<p>æ‰§è¡Œä»¿çœŸéœ€è¦ä¼ é€’ä¸€äº›å‚æ•°ï¼Œå‘½ä»¤æ¨¡æ¿å¦‚ä¸‹</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">{</span>ASTRA_SIM_BIN<span class="o">}</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --workload-configuration<span class="o">=</span><span class="si">${</span><span class="nv">WORKLOAD_CONFIG</span><span class="si">}</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --system-configuration<span class="o">=</span><span class="si">${</span><span class="nv">SYSTEM_CONFIG</span><span class="si">}</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --network-configuration<span class="o">=</span><span class="si">${</span><span class="nv">NETWORK_CONFIG</span><span class="si">}</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --remote-memory-configuration<span class="o">=</span><span class="si">${</span><span class="nv">REMOTE_MEMORY_CONFIG</span><span class="si">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="workload_config">WORKLOAD_CONFIG<a hidden class="anchor" aria-hidden="true" href="#workload_config">#</a></h2>
<p>astra-sim ä½¿ç”¨çš„æ˜¯ Chakra (Execution Trace) ä½œä¸º workload å±‚çš„è¾“å…¥ã€‚å°† chakra ä½œä¸º python package å®‰è£…åæœ‰å‡ ä¸ªå‘½ä»¤é€šè¿‡ pyproject.toml å¯¹åº”åˆ° pythonå‡½æ•°ã€‚</p>
<details class="custom-details">
    <summary class="custom-summary">Explanation of toml file</summary>
    <div><p><code>pyproject.toml</code> æ˜¯ä¸€ä¸ªæ ‡å‡†åŒ–çš„é…ç½®æ–‡ä»¶ï¼Œç”¨äºå®šä¹‰ Python é¡¹ç›®çš„å…ƒæ•°æ®ã€ä¾èµ–å…³ç³»ä»¥åŠæ„å»ºå’Œå¼€å‘å·¥å…·çš„é…ç½®ã€‚</p>
<hr>
<ol>
<li><code>[build-system]</code> æ„å»ºç³»ç»Ÿé…ç½®ï¼Œè¿™éƒ¨åˆ†å®šä¹‰äº†å¦‚ä½•æ„å»ºä½ çš„ Python åŒ…ã€‚</li>
</ol>
<ul>
<li><code>**requires**</code>: åˆ—å‡ºäº†æ„å»ºé¡¹ç›®æœ¬èº«æ‰€å¿…éœ€çš„åŒ…ã€‚è¿™äº›æ˜¯æ„å»ºç¯å¢ƒçš„ä¾èµ–ï¼Œè€Œä¸æ˜¯ä½ ä»£ç è¿è¡Œæ—¶çš„ä¾èµ–ã€‚
<ul>
<li><code>setuptools</code>, <code>setuptools-grpc</code>: è¡¨æ˜æ­¤é¡¹ç›®ä½¿ç”¨ <code>setuptools</code> ä½œä¸ºå…¶æ„å»ºå·¥å…·ï¼Œå¹¶éœ€è¦ <code>setuptools-grpc</code> æ’ä»¶ã€‚</li>
</ul>
</li>
<li><code>**build-backend**</code>: æŒ‡å®šäº†æ„å»ºå·¥å…·ä¸­å®é™…æ‰§è¡Œæ„å»ºè¿‡ç¨‹çš„ Python å¯¹è±¡ï¼ˆå…¥å£ç‚¹ï¼‰ã€‚
<ul>
<li><code>setuptools.build_meta</code>: è¿™æ˜¯ <code>setuptools</code> æä¾›çš„æ ‡å‡†æ„å»ºåç«¯ã€‚</li>
</ul>
</li>
</ul>
<hr>
<ol start="2">
<li><code>[project]</code>ï¼šè¿™éƒ¨åˆ†åŒ…å«äº†é¡¹ç›®çš„åŸºæœ¬ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯ä¼šå±•ç¤ºåœ¨ PyPI (Python Package Index) ä¸Šã€‚</li>
</ol>
<ul>
<li><code>**name**</code>: åŒ…çš„åç§°ï¼Œå³ <code>pip install chakra</code> ä¸­çš„ <code>chakra</code>ã€‚</li>
<li><code>**requires-python**</code>: è¿è¡Œæ­¤åŒ…æ‰€éœ€çš„æœ€ä½ Python ç‰ˆæœ¬ï¼Œè¿™é‡Œæ˜¯ <code>3.7</code> æˆ–æ›´é«˜ã€‚</li>
<li><code>**version**</code>: å½“å‰åŒ…çš„ç‰ˆæœ¬å·ã€‚</li>
<li><code>**readme**</code>: æŒ‡å‘ä¸€ä¸ªæ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶çš„å†…å®¹å°†ä½œä¸ºé¡¹ç›®åœ¨ PyPI ä¸Šçš„è¯¦ç»†æè¿°ã€‚</li>
<li><code>**license**</code>: æŒ‡å‘åŒ…å«è®¸å¯è¯ä¿¡æ¯çš„æ–‡ä»¶ã€‚</li>
<li><code>**authors**</code>ï¼šé¡¹ç›®çš„ä½œè€…ä¿¡æ¯ã€‚</li>
<li><code>**dependencies**</code>: <strong>é¡¹ç›®è¿è¡Œæ—¶çš„ä¾èµ–é¡¹</strong>ã€‚å½“ç”¨æˆ· <code>pip install chakra</code> æ—¶ï¼Œè¿™äº›åŒ…ä¹Ÿä¼šè¢«ä¸€å¹¶å®‰è£…ã€‚
<ul>
<li><code>protobuf==5.*</code>: éœ€è¦ç‰ˆæœ¬ä¸º 5.x çš„ <code>protobuf</code> åº“ã€‚</li>
<li><code>graphviz</code>, <code>networkx</code>, <code>pydot</code>: å…¶ä»–æ ‡å‡†çš„ç¬¬ä¸‰æ–¹åº“ä¾èµ–ã€‚</li>
<li><code>HolisticTraceAnalysis @ git+...</code>: è¿™æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ä¾èµ–ã€‚å®ƒç›´æ¥ä» GitHub ä»“åº“çš„ä¸€ä¸ª<strong>ç‰¹å®š commit</strong> (<code>d731cc...</code>) æ¥å®‰è£…ã€‚è¿™ç¡®ä¿äº†é¡¹ç›®ä¾èµ–äºä¸€ä¸ªç¨³å®šä¸”ä¸ä¼šæ„å¤–å˜åŠ¨çš„ç‰ˆæœ¬ã€‚</li>
</ul>
</li>
</ul>
<hr>
<ol start="3">
<li><code>[project.urls]</code>ï¼šé¡¹ç›®ç›¸å…³é“¾æ¥ï¼Œè¿™äº›é“¾æ¥ä¼šæ˜¾ç¤ºåœ¨ PyPI é¡µé¢çš„ä¾§è¾¹æ ï¼Œä¸ºç”¨æˆ·æä¾›æ›´å¤šä¿¡æ¯çš„å…¥å£ã€‚</li>
</ol>
<ul>
<li><code>**Homepage**</code>, <code>**Documentation**</code>, <code>**Repository**</code>: åˆ†åˆ«æŒ‡å‘é¡¹ç›®ä¸»é¡µã€æ–‡æ¡£å’Œä»£ç ä»“åº“çš„ URLã€‚</li>
</ul>
<hr>
<ol start="4">
<li><code>[tool.setuptools]</code>ï¼šè¿™éƒ¨åˆ†æ˜¯é’ˆå¯¹æ„å»ºå·¥å…· <code>setuptools</code> çš„è¯¦ç»†é…ç½®ã€‚</li>
</ol>
<ul>
<li><code>**package-dir**</code>: å®šä¹‰äº† Python åŒ…åä¸å®é™…æºä»£ç ç›®å½•ä¹‹é—´çš„æ˜ å°„å…³ç³»ã€‚
<ul>
<li>ä¾‹å¦‚ï¼Œ<code>&quot;chakra.src.converter&quot; = &quot;src/converter&quot;</code> è¡¨ç¤ºå½“ç”¨æˆ· <code>import chakra.src.converter</code> æ—¶ï¼ŒPython ä¼šä» <code>src/converter/</code> ç›®å½•ä¸‹å¯»æ‰¾ä»£ç ã€‚è¿™ä½¿å¾—é¡¹ç›®å¯ä»¥ä½¿ç”¨ <code>src</code> å¸ƒå±€ã€‚</li>
</ul>
</li>
<li><code>**package-data**</code>: æŒ‡å®šéœ€è¦åŒ…å«åœ¨æœ€ç»ˆå‘å¸ƒåŒ…ä¸­çš„é Python æ–‡ä»¶ã€‚
<ul>
<li><code>&quot;chakra.schema.protobuf&quot; = [&quot;et_def.proto&quot;]</code>: è¡¨ç¤ºéœ€è¦å°† <code>et_def.proto</code> è¿™ä¸ªæ–‡ä»¶æ‰“åŒ…åˆ° <code>chakra.schema.protobuf</code> è¿™ä¸ªåŒ…é‡Œã€‚</li>
</ul>
</li>
</ul>
<hr>
<ol start="5">
<li><code>[project.scripts]</code>ï¼šè¿™éƒ¨åˆ†å®šä¹‰äº†åœ¨å®‰è£…åŒ…æ—¶åº”åˆ›å»ºçš„å‘½ä»¤è¡Œå·¥å…·ã€‚</li>
</ol>
<ul>
<li><code>**chakra_converter = &quot;chakra.src.converter.converter:main&quot;**</code>: è¿™è¡Œé…ç½®æ„å‘³ç€ï¼Œå½“ç”¨æˆ·å®‰è£…æ­¤åŒ…åï¼Œä»–ä»¬å¯ä»¥åœ¨ç»ˆç«¯ä¸­ç›´æ¥è¿è¡Œ <code>chakra_converter</code> å‘½ä»¤ã€‚æ‰§è¡Œæ­¤å‘½ä»¤æ—¶ï¼Œç³»ç»Ÿä¼šè°ƒç”¨ <code>chakra.src.converter.converter</code> æ¨¡å—ä¸­çš„ <code>main</code> å‡½æ•°ã€‚</li>
</ul>
<hr>
<ol start="6">
<li><code>[tool.ruff]</code>ï¼šè¿™éƒ¨åˆ†æ˜¯ç”¨äºé…ç½® <code>Ruff</code> é«˜æ€§èƒ½ä»£ç æ£€æŸ¥ï¼ˆLinterï¼‰å’Œæ ¼å¼åŒ–ï¼ˆFormatterï¼‰å·¥å…·ã€‚</li>
</ol>
<ul>
<li><code>**target-version**</code>, <code>**line-length**</code>, <code>**exclude**</code>: åŸºæœ¬é…ç½®ï¼Œå¦‚ç›®æ ‡ Python ç‰ˆæœ¬ã€æ¯è¡Œæœ€å¤§é•¿åº¦å’Œè¦æ’é™¤æ£€æŸ¥çš„æ–‡ä»¶ã€‚</li>
<li><code>**[tool.ruff.lint]**</code>: Linter çš„å…·ä½“é…ç½®ã€‚
<ul>
<li><code>**select**</code>: å¯ç”¨ä¸€ç³»åˆ—ä»£ç è§„åˆ™é›†ï¼ˆä¾‹å¦‚ <code>D</code> ä»£è¡¨æ–‡æ¡£å­—ç¬¦ä¸² <code>pydocstyle</code>ï¼Œ<code>I</code> ä»£è¡¨å¯¼å…¥æ’åº <code>isort</code>ï¼‰ã€‚</li>
<li><code>**ignore**</code>: å…¨å±€ç¦ç”¨çš„ç‰¹å®šè§„åˆ™ã€‚æ³¨é‡Šä¸­è§£é‡Šäº†å¿½ç•¥å®ƒä»¬çš„åŸå› ï¼ˆä¾‹å¦‚ï¼Œè§„åˆ™å†²çªæˆ–å¾…åŠäº‹é¡¹ï¼‰ã€‚</li>
<li><code>**per-file-ignores**</code>: é’ˆå¯¹ç‰¹å®šæ–‡ä»¶æˆ–ç›®å½•ç¦ç”¨è§„åˆ™ã€‚ä¾‹å¦‚ï¼Œ<code>&quot;**/tests/*&quot; = [&quot;D&quot;]</code> è¡¨ç¤ºåœ¨æ‰€æœ‰æµ‹è¯•æ–‡ä»¶ä¸­éƒ½ç¦ç”¨æ–‡æ¡£å­—ç¬¦ä¸²æ£€æŸ¥ã€‚</li>
</ul>
</li>
<li><code>**[tool.ruff.format]**</code>: æ ¼å¼åŒ–å™¨çš„é…ç½®ï¼Œå¦‚ä½¿ç”¨ç©ºæ ¼ä½œä¸ºç¼©è¿›é£æ ¼ã€‚</li>
</ul>
<hr>
<ol start="7">
<li><code>[tool.pyright]</code>ï¼šè¿™éƒ¨åˆ†é…ç½®äº† <code>Pyright</code>ï¼Œä¸€ä¸ªç”±å¾®è½¯å¼€å‘çš„é™æ€ç±»å‹æ£€æŸ¥å·¥å…·ã€‚</li>
</ol>
<ul>
<li><code>**typeCheckingMode**</code>: ç±»å‹æ£€æŸ¥çš„ä¸¥æ ¼ç¨‹åº¦ï¼Œè¿™é‡Œæ˜¯ <code>basic</code>ï¼ˆåŸºç¡€æ¨¡å¼ï¼‰ã€‚</li>
<li><code>**exclude**</code>ï¼šåœ¨è¿›è¡Œç±»å‹æ£€æŸ¥æ—¶è¦å¿½ç•¥çš„æ–‡ä»¶å’Œç›®å½•ã€‚</li>
<li><code>**report...**</code>ï¼šå…³é—­ç‰¹å®šçš„é”™è¯¯æˆ–è­¦å‘ŠæŠ¥å‘Šã€‚</li>
</ul>
<hr>
<ol start="8">
<li><code>[tool.vulture]</code>ï¼šè¿™éƒ¨åˆ†é…ç½®äº† <code>Vulture</code>ï¼Œä¸€ä¸ªç”¨äºå‘ç°é¡¹ç›®ä¸­æœªä½¿ç”¨ï¼ˆ&ldquo;æ­»&rdquo;ï¼‰ä»£ç çš„å·¥å…·ã€‚</li>
</ol>
<ul>
<li><code>**ignore_names**</code>: è®© Vulture å¿½ç•¥æŸäº›ç‰¹å®šçš„å˜é‡åæˆ–å‡½æ•°åï¼Œå³ä½¿å®ƒä»¬çœ‹èµ·æ¥æœªä½¿ç”¨ã€‚</li>
<li><code>**min_confidence**</code>: è®¾ç½®æŠ¥å‘Šé—®é¢˜çš„æœ€ä½ç½®ä¿¡åº¦é˜ˆå€¼ã€‚<code>100</code> è¡¨ç¤ºåªæœ‰åœ¨ Vulture 100% ç¡®å®šä»£ç æ˜¯æ— ç”¨çš„æ—¶å€™æ‰ä¼šæŠ¥å‘Šï¼Œè¿™å¯ä»¥æœ‰æ•ˆå‡å°‘è¯¯æŠ¥ã€‚</li>
</ul></div>
</details><br>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-toml" data-lang="toml"><span class="line"><span class="cl"><span class="p">[</span><span class="nx">project</span><span class="p">.</span><span class="nx">scripts</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nx">chakra_converter</span> <span class="p">=</span> <span class="s2">&#34;chakra.src.converter.converter:main&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nx">chakra_generator</span> <span class="p">=</span> <span class="s2">&#34;chakra.src.generator.generator:main&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nx">chakra_jsonizer</span> <span class="p">=</span> <span class="s2">&#34;chakra.src.jsonizer.jsonizer:main&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nx">chakra_timeline_visualizer</span> <span class="p">=</span> <span class="s2">&#34;chakra.src.timeline_visualizer.timeline_visualizer:main&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nx">chakra_trace_link</span> <span class="p">=</span> <span class="s2">&#34;chakra.src.trace_link.trace_link:main&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nx">chakra_visualizer</span> <span class="p">=</span> <span class="s2">&#34;chakra.src.visualizer.visualizer:main&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="generate-execution-trace">Generate Execution Trace<a hidden class="anchor" aria-hidden="true" href="#generate-execution-trace">#</a></h3>
<p>ASTRA-sim çš„ ET å‘½åæ ¼å¼ä¸º <code>{path prefix/trace name}.{npu_id}.et</code>. Chakra ET çš„è·å–æµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤º<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup>ã€‚</p>
<ol>
<li>Collect ET from PyTorch
<ul>
<li>PyTorch ET è´Ÿè´£ CPU ç®—å­ï¼Œå¹¶æ˜ç¡®è¡¨ç¤ºå®ƒä»¬ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚</li>
<li>Kineto Trace ç¼–ç  GPU ç®—å­åŠå…¶å¼€å§‹å’Œç»“æŸæ—¶é—´ã€‚</li>
</ul>
</li>
<li>Merge Trace by <code>chkra_trace_link</code>ï¼šå°†å®ƒä»¬åˆå¹¶ä¸ºä¸€ä¸ª PyTorch ET+. è¯¥æ ¼å¼æœ¬è´¨ä¸Šéµå¾ª PyTorch ET çš„æ¨¡å¼ï¼Œä½†åŒæ—¶ä¹Ÿç¼–ç äº† GPU æ“ä½œç¬¦åŠå…¶ä¾èµ–å…³ç³»ã€‚</li>
<li>Convert to Chakra ET by <code>chakra_converter</code>

<figure class="post-figure">
    <a href="https://private-user-images.githubusercontent.com/7621438/294028976-67228699-cec5-4a4d-b03e-e76647a80ce8.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3NDk1NDQxNDUsIm5iZiI6MTc0OTU0Mzg0NSwicGF0aCI6Ii83NjIxNDM4LzI5NDAyODk3Ni02NzIyODY5OS1jZWM1LTRhNGQtYjAzZS1lNzY2NDdhODBjZTgucG5nP1gtQW16LUFsZ29yaXRobT1BV1M0LUhNQUMtU0hBMjU2JlgtQW16LUNyZWRlbnRpYWw9QUtJQVZDT0RZTFNBNTNQUUs0WkElMkYyMDI1MDYxMCUyRnVzLWVhc3QtMSUyRnMzJTJGYXdzNF9yZXF1ZXN0JlgtQW16LURhdGU9MjAyNTA2MTBUMDgyNDA1WiZYLUFtei1FeHBpcmVzPTMwMCZYLUFtei1TaWduYXR1cmU9OWE4NzAyMGQ0NWQ0MDA2MzIzMmY1MmNhYWU4YWUzNTJiNjI3OTAzZDk2ZDU3NDIwMWJhZTFlMjNjZDhjN2JmMyZYLUFtei1TaWduZWRIZWFkZXJzPWhvc3QifQ.-DDH2mackHVASqoCbmyvN2xl8vZemaa73OiLmBER1o0" target="_blank" rel="noopener">
        <img loading="lazy" src="https://private-user-images.githubusercontent.com/7621438/294028976-67228699-cec5-4a4d-b03e-e76647a80ce8.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3NDk1NDQxNDUsIm5iZiI6MTc0OTU0Mzg0NSwicGF0aCI6Ii83NjIxNDM4LzI5NDAyODk3Ni02NzIyODY5OS1jZWM1LTRhNGQtYjAzZS1lNzY2NDdhODBjZTgucG5nP1gtQW16LUFsZ29yaXRobT1BV1M0LUhNQUMtU0hBMjU2JlgtQW16LUNyZWRlbnRpYWw9QUtJQVZDT0RZTFNBNTNQUUs0WkElMkYyMDI1MDYxMCUyRnVzLWVhc3QtMSUyRnMzJTJGYXdzNF9yZXF1ZXN0JlgtQW16LURhdGU9MjAyNTA2MTBUMDgyNDA1WiZYLUFtei1FeHBpcmVzPTMwMCZYLUFtei1TaWduYXR1cmU9OWE4NzAyMGQ0NWQ0MDA2MzIzMmY1MmNhYWU4YWUzNTJiNjI3OTAzZDk2ZDU3NDIwMWJhZTFlMjNjZDhjN2JmMyZYLUFtei1TaWduZWRIZWFkZXJzPWhvc3QifQ.-DDH2mackHVASqoCbmyvN2xl8vZemaa73OiLmBER1o0" alt="Overview of Trace Collection">
    </a><figcaption>Overview of Trace Collection</figcaption></figure></li>
</ol>
<p>å…·ä½“çš„æ•™ç¨‹å’Œä¾‹å­å¯ä»¥åœ¨ <a href="https://github.com/mlcommons/chakra/wiki/Chakra-Execution-Trace-Collection-%E2%80%90-A-Comprehensive-Guide-on-Merging-PyTorch-and-Kineto-Traces#3-from-raw-traces-to-chakra-a-step-by-step-conversion-guide">Conversion Guide</a> å’Œ <a href="https://github.com/mlcommons/chakra/wiki/Chakra-Execution-Trace-Collection-%E2%80%90-A-Comprehensive-Guide-on-Merging-PyTorch-and-Kineto-Traces#3-from-raw-traces-to-chakra-a-step-by-step-conversion-guide">Practical Example</a> æ‰¾åˆ°ã€‚</p>
<h3 id="using-et-converter">Using ET Converter<a hidden class="anchor" aria-hidden="true" href="#using-et-converter">#</a></h3>
<p>å¯ä»¥å°† astra-sim 1.0 çš„æ–‡æœ¬è¾“å…¥è½¬æ¢æˆ Chakra ET.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">cd</span> ./extern/graph_frontend/chakra/
</span></span><span class="line"><span class="cl">pip3 install .
</span></span><span class="line"><span class="cl">chakra_converter Text <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --input ../../../examples/text_converter/text_workloads/Resnet50_DataParallel.txt <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --output ../../../examples/text_converter/text_workloads/Resnet50_DataParallel <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --num-npus <span class="m">8</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --num-passes <span class="m">1</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>workload æ–‡æœ¬æ ¼å¼è¦æ±‚å¦‚ä¸‹ï¼Œå…¶ä¸­é€šä¿¡å¤§å°å•ä½æ˜¯å­—èŠ‚ï¼Œè®¡ç®—æ—¶é—´ä»¥å‘¨æœŸæ•°è¡¨ç¤ºã€‚</p>
<ul>
<li>ç¬¬ä¸€è¡Œï¼š(DATA/HYBRID_TRANSFORMER/HYBRID_DLRM)
<ul>
<li>è¯¥è¡ŒæŒ‡å®šè®­ç»ƒå¾ªç¯çš„å¹¶è¡ŒåŒ–ç±»å‹ã€‚DATA è¡¨ç¤ºçº¯æ•°æ®å¹¶è¡Œæ–¹æ³•ï¼ŒHYBRID_TRANSFORMER è¡¨ç¤ºä¸“ä¸º Transformer DNN ç½‘ç»œè®¾è®¡çš„æ··åˆå¹¶è¡Œæ–¹æ³•ï¼Œè€Œ HYBRID_DLRM è¡¨ç¤ºä¸“ä¸º DLRM DNN ç½‘ç»œä¼˜åŒ–çš„æ··åˆå¹¶è¡Œæ–¹æ³•ã€‚</li>
</ul>
</li>
<li>ç¬¬äºŒè¡Œï¼š(int)
<ul>
<li>è¯¥è¡Œè¡¨ç¤º DNN çš„å±‚æ•°ã€‚</li>
</ul>
</li>
<li>åç»­è¡Œï¼šæ¯è¡Œæè¿°ä¸€å±‚ã€‚å±‚çš„æè¿°æ ¼å¼å¦‚ä¸‹ï¼š
<ul>
<li>{(string: å±‚åç§°)</li>
<li>(int: ä¿ç•™å˜é‡)</li>
<li>(int: å‰å‘è®¡ç®—æ—¶é—´)</li>
<li>(ALLREDUCE/ALLGATHER/ALLTOALL: å‰å‘é€šä¿¡ç±»å‹)</li>
<li>(int: å‰å‘é€šä¿¡å¤§å°)</li>
<li>(int: è¾“å…¥æ¢¯åº¦è®¡ç®—æ—¶é—´)</li>
<li>(ALLREDUCE/ALLGATHER/ALLTOALL: è¾“å…¥æ¢¯åº¦é€šä¿¡ç±»å‹)</li>
<li>(int: è¾“å…¥æ¢¯åº¦é€šä¿¡å¤§å°)</li>
<li>(int: æƒé‡æ¢¯åº¦è®¡ç®—æ—¶é—´)</li>
<li>(ALLREDUCE/ALLGATHER/ALLTOALL: æƒé‡æ¢¯åº¦é€šä¿¡ç±»å‹)</li>
<li>(int: æƒé‡æ¢¯åº¦é€šä¿¡å¤§å°)</li>
<li>(é›†åˆé€šä¿¡å®Œæˆåï¼Œæƒé‡/è¾“å…¥/è¾“å‡ºæ›´æ–°çš„å»¶è¿Ÿ)}`</li>
</ul>
</li>
</ul>
<style type="text/css">
     
    .notice {
        --title-color: #fff;
        --title-background-color: #6be;
        --content-color: #444;
        --content-background-color: #e7f2fa;
    }

    .notice.info {
        --title-background-color: #fb7;
        --content-background-color: #fec;
    }

    .notice.tip {
        --title-background-color: #5a5;
        --content-background-color: #efe;
    }

    .notice.warning {
        --title-background-color: #c33;
        --content-background-color: #fee;
    }

     
    @media (prefers-color-scheme:dark) {
        .notice {
            --title-color: #fff;
            --title-background-color: #069;
            --content-color: #ddd;
            --content-background-color: #023;
        }

        .notice.info {
            --title-background-color: #a50;
            --content-background-color: #420;
        }

        .notice.tip {
            --title-background-color: #363;
            --content-background-color: #121;
        }

        .notice.warning {
            --title-background-color: #800;
            --content-background-color: #400;
        }
    }

    body.dark .notice {
        --title-color: #fff;
        --title-background-color: #069;
        --content-color: #ddd;
        --content-background-color: #023;
    }

    body.dark .notice.info {
        --title-background-color: #a50;
        --content-background-color: #420;
    }

    body.dark .notice.tip {
        --title-background-color: #363;
        --content-background-color: #121;
    }

    body.dark .notice.warning {
        --title-background-color: #800;
        --content-background-color: #400;
    }

     
    .notice {
        padding: 18px;
        line-height: 24px;
        margin-bottom: 24px;
        border-radius: 4px;
        color: var(--content-color);
        background: var(--content-background-color);
    }

    .notice p:last-child {
        margin-bottom: 0
    }

     
    .notice-title {
        margin: -18px -18px 12px;
        padding: 4px 18px;
        border-radius: 4px 4px 0 0;
        font-weight: 700;
        color: var(--title-color);
        background: var(--title-background-color);
    }

     
    .icon-notice {
        display: inline-flex;
        align-self: center;
        margin-right: 8px;
    }

    .icon-notice img,
    .icon-notice svg {
        height: 1em;
        width: 1em;
        fill: currentColor;
    }

    .icon-notice img,
    .icon-notice.baseline svg {
        top: .125em;
        position: relative;
    }
</style><div class="notice note" >
    <p class="notice-title">
        <span class="icon-notice baseline">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 128 300 300">
  <path d="M150 128c82.813 0 150 67.188 150 150 0 82.813-67.188 150-150 150C67.187 428 0 360.812 0 278c0-82.813 67.188-150 150-150Zm25 243.555v-37.11c0-3.515-2.734-6.445-6.055-6.445h-37.5c-3.515 0-6.445 2.93-6.445 6.445v37.11c0 3.515 2.93 6.445 6.445 6.445h37.5c3.32 0 6.055-2.93 6.055-6.445Zm-.39-67.188 3.515-121.289c0-1.367-.586-2.734-1.953-3.516-1.172-.976-2.93-1.562-4.688-1.562h-42.968c-1.758 0-3.516.586-4.688 1.563-1.367.78-1.953 2.148-1.953 3.515l3.32 121.29c0 2.734 2.93 4.882 6.64 4.882h36.134c3.515 0 6.445-2.148 6.64-4.883Z"/>
</svg>

        </span>Note</p><p>æ¯ä¸€å±‚çš„å‚æ•°å†™è¦åœ¨åŒä¸€è¡Œï¼ï¼ï¼</p></div>

<h3 id="enable-communicator-groups">Enable Communicator Groups<a hidden class="anchor" aria-hidden="true" href="#enable-communicator-groups">#</a></h3>
<p>astra-sim 2.0 æ”¯æŒ<a href="https://docs.nvidia.com/deeplearning/nccl/user-guide/docs/usage/communicators.html">é€šä¿¡ç»„</a>ã€‚å¯ä»¥é€šè¿‡æŒ‡å®š <code>--comm-group-configuration</code> JSON æ–‡ä»¶æ¥æŒ‡å®šï¼Œé»˜è®¤åªæœ‰ä¸€ä¸ªé€šä¿¡ç»„ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="c1">// The first/second communicator group, with ID 0/1, includes GPU IDs from 0-3/4-7. 
</span></span></span><span class="line"><span class="cl"><span class="c1">//   &#34;0&#34;: [0, 1, 2, 3],
</span></span></span><span class="line"><span class="cl"><span class="c1">//   &#34;1&#34;: [4, 5, 6, 7]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nt">&#34;&lt;communicator_group_id&gt;&#34;</span> <span class="p">:</span> <span class="p">[</span><span class="err">gpu_ids</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h2 id="system_config">SYSTEM_CONFIG<a hidden class="anchor" aria-hidden="true" href="#system_config">#</a></h2>
<h1 id="system-layer">System Layer<a hidden class="anchor" aria-hidden="true" href="#system-layer">#</a></h1>
<p>Workload å±‚ä¼šéå† Chakra ET ä¸­çš„èŠ‚ç‚¹ï¼Œå¹¶ä¸ºæ¯ä¸ªèŠ‚ç‚¹æ‰€æŒ‡ä»£çš„æ“ä½œå‘å‡ºç›¸åº”çš„å‘½ä»¤ã€‚System å±‚æ¥æ”¶è¿™äº›å‘½ä»¤ï¼Œå¹¶å°†å…¶è½¬æ¢ä¸ºé€‚åˆç½‘ç»œã€è®¡ç®—æˆ–å†…å­˜åç«¯çš„æ ¼å¼ï¼Œä»è€Œæ­£ç¡®æ¨¡æ‹Ÿæ“ä½œã€‚æ ¹æ®æ“ä½œçš„ç±»å‹ï¼Œç³»ç»Ÿå±‚çš„è¡Œä¸ºä¼šæœ‰æ‰€ä¸åŒï¼Œå…·ä½“å¦‚ä¸‹ï¼š</p>
<ul>
<li>è®¡ç®—æ“ä½œï¼šå‘è®¡ç®—åç«¯å‘å‡ºè°ƒç”¨ï¼Œä»¥æ¨¡æ‹Ÿæ“ä½œçš„æŒç»­æ—¶é—´ã€‚</li>
<li>å†…å­˜æ“ä½œï¼š  å†…å­˜</li>
<li>é€šä¿¡æ“ä½œï¼šå°†é›†åˆé€šä¿¡åˆ†è§£ä¸ºç‚¹å¯¹ç‚¹çš„å‘é€å’Œæ¥æ”¶æ¶ˆæ¯ï¼Œå¹¶å‘ç½‘ç»œåç«¯å‘å‡ºâ€œå‘é€â€æˆ–â€œæ¥æ”¶â€è°ƒç”¨ï¼Œä»¥æ¨¡æ‹Ÿæ¶ˆæ¯çš„ä¼ è¾“è¿‡ç¨‹ã€‚</li>
</ul>
<h2 id="collective-scheduler">Collective Scheduler<a hidden class="anchor" aria-hidden="true" href="#collective-scheduler">#</a></h2>
<p>
<figure class="post-figure">
    <a href="https://astra-sim.github.io/astra-sim-docs/_images/system_overview_queue.svg" target="_blank" rel="noopener">
        <img loading="lazy" src="https://astra-sim.github.io/astra-sim-docs/_images/system_overview_queue.svg" alt="Collective Scheduler">
    </a><figcaption>Collective Scheduler</figcaption></figure></p>
<p>æ¯ä¸ªé˜Ÿåˆ—éƒ½æœ‰è®¸å¤š <code>StreamBaseline</code> å¯¹è±¡ (å›¾ä¸­å³ä¸Šè§’)ï¼Œä»£è¡¨äº†æ•´ä¸ªé›†åˆé€šä¿¡çš„æµç¨‹ï¼Œ<code>phase_to_go</code> æ˜¯ä¸€ä¸ªç”¨äºè¡¨ç¤ºè¿™äº›é˜¶æ®µçš„é˜Ÿåˆ—ï¼Œ<code>my_current_phase</code> æ˜¯æŒ‡å‘å½“å‰æ‰§è¡Œé˜¶æ®µçš„æŒ‡é’ˆã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">StreamBaseline</span> <span class="o">:</span> <span class="k">public</span> <span class="n">BaseStream</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">StreamBaseline</span><span class="p">(</span><span class="n">Sys</span><span class="o">*</span> <span class="n">owner</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                   <span class="n">DataSet</span><span class="o">*</span> <span class="n">dataset</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                   <span class="kt">int</span> <span class="n">stream_id</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                   <span class="n">std</span><span class="o">::</span><span class="n">list</span><span class="o">&lt;</span><span class="n">CollectivePhase</span><span class="o">&gt;</span> <span class="n">phases_to_go</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                   <span class="kt">int</span> <span class="n">priority</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// my_current_phase[CollectivePhase] is defined in BaseStream
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">void</span> <span class="nf">init</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">call</span><span class="p">(</span><span class="n">EventType</span> <span class="n">event</span><span class="p">,</span> <span class="n">CallData</span><span class="o">*</span> <span class="n">data</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">consume</span><span class="p">(</span><span class="n">RecvPacketEventHandlerData</span><span class="o">*</span> <span class="n">message</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¯¹äºæ¯ä¸ª stream <code>proceed_to_next_vnet_baseline</code> (astra-sim/system/Sys.cc) ç”¨äºæ¨è¿›é€šä¿¡é˜¶æ®µå¹¶ä¸”è´Ÿè´£åœ¨é˜Ÿåˆ—ä¹‹é—´ç§»åŠ¨ stream å¯¹è±¡ã€‚ä»¥ä¸‹å‡ ç§æƒ…å†µä¼šè°ƒç”¨è¯¥å‡½æ•°ï¼š</p>
<ol>
<li>stream ç¬¬ä¸€æ¬¡è¢«ç§»åŠ¨å‡º ready_list å¹¶ä¸”å°†è¢«æ’å…¥åˆ° <code>active_streams</code>.</li>
<li>stream å®Œæˆäº†ä¸€ä¸ªé€šä¿¡é˜¶æ®µå¹¶ä¸”ç­‰å¾…ä¸‹ä¸€ä¸ªé˜¶æ®µã€‚</li>
<li>stream å®Œæˆäº†æ‰€æœ‰çš„é€šä¿¡é˜¶æ®µã€‚</li>
</ol>
<p>(2-1) åˆ° (2-5) æè¿°äº†è¯¥å‡½æ•°çš„è¡Œä¸º</p>
<ol>
<li>
<p>æŸ¥çœ‹å½“å‰æŒæœ‰ stream çš„é˜Ÿåˆ—: ä»é˜Ÿåˆ—ä¸­åˆ é™¤ <code>StreamBaseline</code> å¯¹è±¡ (æµçš„å®Œæˆé¡ºåºå¯èƒ½ä¸å®ƒä»¬å¼€å§‹æ‰§è¡Œçš„é¡ºåºä¸åŒ)ã€‚</p>
</li>
<li>
<p>ä¿®æ”¹ <code>StreamBaseline</code> å¯¹è±¡: å·²å®Œæˆçš„é›†åˆé€šä¿¡é˜¶æ®µä» <code>phases_to_go</code> ä¸­å¼¹å‡ºï¼Œ<code>my_current_phase</code> ç°åœ¨æŒ‡å‘ä¸‹ä¸€ä¸ªå¾…æ‰§è¡Œçš„é˜¶æ®µã€‚</p>
</li>
<li>
<p>ä½¿ç”¨ <code>insert_stream</code> å°† <code>StreamBaseline</code> å¯¹è±¡æ’å…¥åˆ°ä¸‹ä¸€ä¸ªé˜Ÿåˆ—ä¸­ã€‚</p>
</li>
<li>
<p>è°ƒç”¨å‡½æ•° <code>notify_stream_removed</code> å‡½æ•°æŸ¥çœ‹å‰ä¸€ä¸ªé˜Ÿåˆ—çš„å¤´éƒ¨ã€‚ <code>stream_pointer</code> æŒ‡å‘é˜Ÿåˆ—ä¸­ç¬¬ä¸€ä¸ªæœªè¿è¡Œçš„ stream (æ ‡è®°ä¸ºè“è‰²)ã€‚è¯¥å‡½æ•°é€šè¿‡è°ƒç”¨ <code>StreamBaseline::init()</code> æ¥å¯åŠ¨ stream çš„ä¸‹ä¸€ä¸ªé˜¶æ®µçš„æ‰§è¡Œã€‚</p>
</li>
<li>
<p>ä½¿ç”¨ <code>notify_stream_added</code> è§¦å‘æ–°é˜Ÿåˆ—å¤´éƒ¨ stream çš„é€šä¿¡é˜¶æ®µæ‰§è¡Œã€‚</p>
</li>
</ol>
<p>åœ¨å…¶ä»–æƒ…å†µä¸‹ï¼Œ<code>proceed_to_next_vnet_baseline</code> ä¼šæ‰§è¡Œä¸Šè¿°æ­¥éª¤çš„ä¸€éƒ¨åˆ†ã€‚å…·ä½“å¦‚ä¸‹ï¼š</p>
<ol>
<li>
<p>åˆšä» <code>ready_list</code> ä¸­ç§»é™¤ï¼š<br>
<code>proceed_to_next..</code> ä¼šåˆå§‹åŒ– stream (1-2)ï¼Œå°†å…¶æ’å…¥åˆ°ç¬¬ä¸€ä¸ªé˜Ÿåˆ—ä¸­ (1-3)ï¼Œå¹¶è§¦å‘è¯¥é˜Ÿåˆ—å¤´éƒ¨çš„æµæ‰§è¡Œã€‚</p>
</li>
<li>
<p>stream å®Œæˆï¼š<br>
è¯¥å‡½æ•°ä¼šä»ä¹‹å‰çš„é˜Ÿåˆ—ä¸­åˆ é™¤ stream (3-1)ï¼Œå¹¶è§¦å‘ä¹‹å‰é˜Ÿåˆ—å¤´éƒ¨çš„ stream æ‰§è¡Œã€‚æ­¤å¤–ï¼Œ<code>StreamBaseline</code> å¯¹è±¡ä¼šè¢«åˆ é™¤ï¼Œå¹¶è°ƒç”¨ <code>notify_stream_finished</code>ï¼Œä»¥é€šçŸ¥ <code>Sys</code> å¯¹è±¡ stream å·²ç»ç»“æŸ (3-6)</p>
</li>
</ol>
<h2 id="collective-implementation">Collective Implementation<a hidden class="anchor" aria-hidden="true" href="#collective-implementation">#</a></h2>
<p>
<figure class="post-figure">
    <a href="https://astra-sim.github.io/astra-sim-docs/_images/coll_implementation.svg" target="_blank" rel="noopener">
        <img loading="lazy" src="https://astra-sim.github.io/astra-sim-docs/_images/coll_implementation.svg" alt="Overview of Collective Implementation">
    </a><figcaption>Overview of Collective Implementation</figcaption></figure>
æ¨¡æ‹Ÿå™¨å°†é›†ä½“é€šä¿¡åˆ†è§£ä¸ºå‘é€å’Œæ¥æ”¶æ¶ˆæ¯çš„æ–¹å¼æœ‰ä¸¤ç§ã€‚ç›®å‰æœ€å¸¸ç”¨çš„æ–¹æ³•æ˜¯æ¨¡æ‹Ÿå™¨å®ç°ä¸€ç»„é¢„å®šä¹‰çš„å¸¸è§ç®—æ³• (ä¾‹å¦‚ Ringã€DoubleBinaryã€HalvingDoubling ç­‰)ã€‚è¿™ç§â€œåŸç”Ÿâ€å®ç°é€»è¾‘ä½äºæ¨¡æ‹Ÿå™¨çš„ä»£ç åº“ä¸­ï¼Œå…è®¸ç”¨æˆ·å¿«é€Ÿæ¢ç´¢ä¸€ç»„é¢„å®šä¹‰çš„ç®—æ³•ã€‚</p>
<p>è‡ª 2024 å¹´ 8 æœˆä»¥æ¥ï¼ŒASTRA-sim æ”¯æŒäº†ä¸€ç§æ–°çš„é›†åˆé€šä¿¡ç®—æ³•è¡¨ç¤ºæ–¹å¼ã€‚System å±‚é€šè¿‡æš´éœ²ä¸€ä¸ªé›†ä½“ APIï¼Œå¯ä»¥æ¥æ”¶ä»»æ„é›†ä½“ç®—æ³•çš„å®šä¹‰ã€‚</p>
<p>è¿™ä¸¤ç§æ–¹æ³•éƒ½æ˜¯å¯¹ <code>CollectivePhase::Algorithm</code> å¯¹è±¡çš„å®ç°ï¼Œè¯¥å¯¹è±¡æ˜¯ System å±‚ä¸­çš„è°ƒåº¦å•å…ƒ. <a href="https://github.com/astra-sim/astra-sim/blob/15a4334ade00fe1040fd00495cd13fd1ea5177e4/astra-sim/system/Sys.cc#L1037">generate_collective_phase</a> ä¼šæ ¹æ®ä¸åŒçš„ç®—æ³•åœ¨åˆ›å»º <a href="https://github.com/astra-sim/astra-sim/blob/15a4334ade00fe1040fd00495cd13fd1ea5177e4/astra-sim/system/CollectivePhase.hh#L17">CollectivePhase</a> çš„æ—¶å€™ä¼ å…¥å¯¹åº”çš„ Algorithm.</p>
<h3 id="astra-sim-native-implementation">ASTRA-Sim Native Implementation<a hidden class="anchor" aria-hidden="true" href="#astra-sim-native-implementation">#</a></h3>
<p>ç›¸å…³çš„å®ç°éƒ½ä½äº<a href="https://github.com/astra-sim/astra-sim/tree/master/astra-sim/system/collective">è¯¥æ–‡ä»¶å¤¹</a>ä¸‹, naive å®ç°çš„é™åˆ¶æ˜¯å½“éœ€è¦æ¨¡æ‹Ÿä¸€ä¸ªæ–°çš„é›†åˆé€šä¿¡ç®—æ³•æ—¶ç®—æ³•ï¼Œå¿…é¡»å®ç°æ•´ä¸ªé›†åˆï¼Ÿéšç€ä¸è§„åˆ™é›†åˆé€šä¿¡ (å¦‚ TACOS(Topology Aware CollectiveS), MSCCLang(åŸºäº DSL)) ä¸­å·¥ä½œçš„å¢åŠ ï¼Œå¿«é€Ÿæ¨¡æ‹Ÿå’Œè¿­ä»£å„ç§ç®—æ³•çš„éœ€æ±‚å˜å¾—è¶Šæ¥è¶Šå¤šã€‚</p>
<h3 id="chakra-based-arbitrary-definition-through-collective-api">Chakra Based Arbitrary Definition Through Collective API<a hidden class="anchor" aria-hidden="true" href="#chakra-based-arbitrary-definition-through-collective-api">#</a></h3>
<p>å› æ­¤ä¸€ä¸ªæ–°çš„ APæ¥æ¥å—ä»»ä½•é›†åˆé€šä¿¡ç®—æ³•çš„å®šä¹‰ï¼Œè€Œä¸å±€é™äºé¢„å®šä¹‰çš„è§„åˆ™é€šä¿¡æ¨¡å¼ã€‚å¯¹äºé€šä¿¡è¡¨ç¤ºï¼Œä½¿ç”¨ Chakra ET æ¨¡å¼ä½œä¸ºå•ç‹¬çš„å›¾ã€‚å°†é›†åˆé€šä¿¡ç®—æ³•è¡¨ç¤ºä¸ºChakra ET æ¨¡å¼ä¸­ COMM_SENDï¼ŒCOMM_RECV èŠ‚ç‚¹çš„å›¾ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒSystem å±‚ä¸æ˜¯å°†é›†åˆé€šä¿¡åˆ†è§£ä¸ºå‘é€å’Œæ¥æ”¶æ¶ˆæ¯ï¼Œè€Œæ˜¯ç®€å•åœ°éµå¾ª Chakra å›¾ä¸­å·²ç»è¡¨ç¤ºçš„åˆ†è§£ã€‚ç”±äºå·²ç»ä½¿ç”¨ Chakra ET æ¥è¡¨ç¤º workloadï¼Œä½¿ç”¨ Chakra ET æ¥é¢å¤–å®šä¹‰é›†åˆé€šä¿¡ç®—æ³•æä¾›äº†ä¸€ç§è½»æ¾ç®€å•çš„æ–¹å¼æ¥éå†æ•´ä¸ªå›¾ã€‚</p>
<p>å¦‚ä¸Šå›¾æ‰€ç¤ºå½“ workload å±‚å‘å‡º AllReduce é›†ä½“æ“ä½œæ—¶ï¼ŒSystem å±‚ä¸ä¼šè¿è¡Œæ¨¡æ‹Ÿå™¨ä»£ç åº“ä¸­å·²æœ‰çš„åŸç”Ÿå®ç°é€»è¾‘ï¼Œè€Œæ˜¯ä¼šéå†é€šè¿‡ API æä¾›çš„ Chakra ETï¼Œè¯¥ ET è¡¨ç¤ºé›†åˆé€šä¿¡ç®—æ³•ã€‚éœ€è¦æ³¨æ„ workload Chakra å›¾å’Œé›†åˆé€šä¿¡ç®—æ³•çš„ Chakra å›¾æ˜¯è§£è€¦çš„ï¼Œå¹¶é€šè¿‡ä¸åŒçš„è¾“å…¥ç‚¹æä¾›ã€‚æœ€ç»ˆï¼Œasytra-sim æ¨¡æ‹Ÿå™¨ä¼šå°†é€šä¿¡èŠ‚ç‚¹æ›¿æ¢ä¸ºé›†ä½“å®ç°ã€‚</p>
<h2 id="input-files-for-collective-api">Input Files for Collective API<a hidden class="anchor" aria-hidden="true" href="#input-files-for-collective-api">#</a></h2>
<h3 id="astra-sim-native">ASTRA-sim Native<a hidden class="anchor" aria-hidden="true" href="#astra-sim-native">#</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="s2">&#34;active-chunks-per-dimension&#34;</span><span class="err">:</span> <span class="mi">1</span><span class="err">,</span>
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;all-reduce-implementation&#34;</span><span class="err">:</span> <span class="p">[</span><span class="s2">&#34;ring&#34;</span><span class="p">]</span><span class="err">,</span>
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;all-gather-implementation&#34;</span><span class="err">:</span> <span class="p">[</span><span class="s2">&#34;ring&#34;</span><span class="p">,</span> <span class="s2">&#34;doubleBinaryTree&#34;</span><span class="p">]</span><span class="err">,</span>
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;all-to-all-implementation&#34;</span><span class="err">:</span> <span class="p">[</span><span class="s2">&#34;ring&#34;</span><span class="p">,</span> <span class="s2">&#34;doubleBinaryTree&#34;</span><span class="p">,</span> <span class="s2">&#34;halvingDoubling&#34;</span><span class="p">]</span><span class="err">,</span>
</span></span><span class="line"><span class="cl"><span class="c1">// ...
</span></span></span></code></pre></div><p><code>all-*-implementation</code> æŒ‡å®šäº†æ¨¡æ‹Ÿå™¨å°†å¦‚ä½•å°†ç»™å®šçš„é›†åˆé€šä¿¡åˆ†è§£ä¸ºå‘é€å’Œæ¥æ”¶æ¶ˆæ¯ã€‚All-Gather æ“ä½œåˆ—è¡¨ä¸­çš„ä¸¤ä¸ªæ¡ç›®è¡¨ç¤ºæ¨¡æ‹Ÿå™¨å°†æŒ‰ä¸¤ä¸ªç»´åº¦åˆ†è§£ â€”â€”ç¬¬ä¸€ä¸ªç»´åº¦ä½¿ç”¨ Ring ç®—æ³•ï¼Œç¬¬äºŒä¸ªç»´åº¦ä½¿ç”¨ doubleBinaryTree ç®—æ³•ã€‚</p>
<blockquote class="quote"><p>Native Implementation Requires That the Dimensions for Collective Algorithms Are Same Across All Collectives.</p></blockquote>
<div class="notice warning" >
    <p class="notice-title">
        <span class="icon-notice baseline">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="126 76.5 300 300">
  <path d="M297.431 324.397v-34.255c0-3.245-2.344-5.95-5.358-5.95h-32.146c-3.014 0-5.358 2.705-5.358 5.95v34.255c0 3.245 2.344 5.95 5.358 5.95h32.146c3.014 0 5.358-2.705 5.358-5.95Zm-.335-67.428 3.014-82.753c0-1.081-.502-2.524-1.674-3.425-1.005-.902-2.512-1.983-4.019-1.983h-36.834c-1.507 0-3.014 1.081-4.019 1.983-1.172.901-1.674 2.704-1.674 3.786l2.846 82.392c0 2.344 2.512 4.146 5.693 4.146h30.975c3.013 0 5.525-1.803 5.692-4.146Zm-2.344-168.39L423.34 342.425c3.683 7.032 3.516 15.686-.335 22.717-3.85 7.031-10.883 11.358-18.417 11.358H147.413c-7.534 0-14.566-4.327-18.417-11.358-3.85-7.031-4.018-15.685-.335-22.716L257.248 88.578C260.93 81.188 268.13 76.5 276 76.5c7.87 0 15.069 4.688 18.752 12.08Z"/>
</svg>

        </span>Warning</p><p><strong>Native å®ç°è¦æ±‚æ‰€æœ‰é›†ä½“æ“ä½œçš„ç»´åº¦å¿…é¡»ç›¸åŒ</strong>ã€‚æ¢å¥è¯è¯´ï¼Œå¦‚æœä¸€ä¸ªé›†åˆé€šä¿¡ç®—æ³•è¢«å®šä¹‰ä¸ºäºŒç»´çš„ï¼Œé‚£ä¹ˆå…¶ä»–é›†åˆé€šä¿¡ç®—æ³•ä¹Ÿå¿…é¡»æ˜¯äºŒç»´æ“ä½œã€‚ä¸Šè¿°åªæ˜¯ä¸€ä¸ªä¾‹å­ã€‚</p></div>

<h3 id="collective-api">Collective API<a hidden class="anchor" aria-hidden="true" href="#collective-api">#</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="s2">&#34;active-chunks-per-dimension&#34;</span><span class="err">:</span> <span class="mi">1</span><span class="err">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;all-reduce-implementation-chakra&#34;</span><span class="err">:</span> <span class="p">[</span><span class="s2">&#34;/app/hoti2024/demo5/inputs/custom_ring&#34;</span><span class="p">]</span><span class="err">,</span>
</span></span><span class="line"><span class="cl"><span class="c1">// ...
</span></span></span></code></pre></div><p>éœ€è¦æ³¨æ„è¿™é‡Œè¦ä½¿ç”¨ <code>all-*-implementation-chakra</code>ï¼Œè€Œä¸æ˜¯ <code>all-*-implementation</code>. å¦å¤–  Chakra ET æ–‡ä»¶ä¸ä¼ é€’ç»™ workload å±‚çš„æ–‡ä»¶æ˜¯ä¸åŒçš„ï¼Œæ¯ä¸€é¡¹çš„å€¼æ˜¯ Chakra ET æ–‡ä»¶çš„ç»å¯¹è·¯å¾„ï¼Œä¸åŒ…æ‹¬æœ€åçš„ <code>{rank}.et</code> å­—ç¬¦ä¸² (ç±»ä¼¼äº Workload å±‚è¾“å…¥)ã€‚æ­¤å¤–ï¼Œå³ä½¿æœ‰è®¸å¤šç»´åº¦ï¼Œåˆ—è¡¨ä¹Ÿåªæ¥å—ä¸€ä¸ªå€¼ã€‚è¿™æ˜¯å› ä¸ºè·¨ç»´åº¦é€šä¿¡çš„æ¦‚å¿µå·²ç»åŒ…å«åœ¨ ET ä¸­ã€‚</p>
<div class="github">
    <div class="github_bar">
        <svg xmlns="http://www.w3.org/2000/svg" width="50" height="50" viewBox="0 0 50 50"><path d="M17.791,46.836C18.502,46.53,19,45.823,19,45v-5.4c0-0.197,0.016-0.402,0.041-0.61C19.027,38.994,19.014,38.997,19,39 c0,0-3,0-3.6,0c-1.5,0-2.8-0.6-3.4-1.8c-0.7-1.3-1-3.5-2.8-4.7C8.9,32.3,9.1,32,9.7,32c0.6,0.1,1.9,0.9,2.7,2c0.9,1.1,1.8,2,3.4,2 c2.487,0,3.82-0.125,4.622-0.555C21.356,34.056,22.649,33,24,33v-0.025c-5.668-0.182-9.289-2.066-10.975-4.975 c-3.665,0.042-6.856,0.405-8.677,0.707c-0.058-0.327-0.108-0.656-0.151-0.987c1.797-0.296,4.843-0.647,8.345-0.714 c-0.112-0.276-0.209-0.559-0.291-0.849c-3.511-0.178-6.541-0.039-8.187,0.097c-0.02-0.332-0.047-0.663-0.051-0.999 c1.649-0.135,4.597-0.27,8.018-0.111c-0.079-0.5-0.13-1.011-0.13-1.543c0-1.7,0.6-3.5,1.7-5c-0.5-1.7-1.2-5.3,0.2-6.6 c2.7,0,4.6,1.3,5.5,2.1C21,13.4,22.9,13,25,13s4,0.4,5.6,1.1c0.9-0.8,2.8-2.1,5.5-2.1c1.5,1.4,0.7,5,0.2,6.6c1.1,1.5,1.7,3.2,1.6,5 c0,0.484-0.045,0.951-0.11,1.409c3.499-0.172,6.527-0.034,8.204,0.102c-0.002,0.337-0.033,0.666-0.051,0.999 c-1.671-0.138-4.775-0.28-8.359-0.089c-0.089,0.336-0.197,0.663-0.325,0.98c3.546,0.046,6.665,0.389,8.548,0.689 c-0.043,0.332-0.093,0.661-0.151,0.987c-1.912-0.306-5.171-0.664-8.879-0.682C35.112,30.873,31.557,32.75,26,32.969V33 c2.6,0,5,3.9,5,6.6V45c0,0.823,0.498,1.53,1.209,1.836C41.37,43.804,48,35.164,48,25C48,12.318,37.683,2,25,2S2,12.318,2,25 C2,35.164,8.63,43.804,17.791,46.836z"></path></svg>
        <a class="github_name" href="https://github.com/astra-sim/collectiveapi" target="_blank">Collective API</a>
    </div>
    <div class="github_description">å‚è€ƒè¯¥ä»“åº“å®ç°</div>
    <div class="github_language">
        
    </div>
</div>

<h1 id="network-backend">Network Backend<a hidden class="anchor" aria-hidden="true" href="#network-backend">#</a></h1>
<h2 id="analytical-network-backend">Analytical Network Backend<a hidden class="anchor" aria-hidden="true" href="#analytical-network-backend">#</a></h2>
<p>Analytical Network æ¨¡æ‹Ÿå™¨é€šè¿‡æ•°å­¦æ–¹ç¨‹æ¨¡æ‹Ÿæ‰€æœ‰ç½‘ç»œè¡Œä¸ºã€‚å› æ­¤ï¼Œè¯¥åç«¯æœ€é€‚åˆäºå¤§è§„æ¨¡åˆ†å¸ƒå¼å¹³å°çš„å»ºæ¨¡å’Œä»¿çœŸã€‚ç›®å‰æ”¯æŒä¸¤ç§åˆ†ææ¨¡å¼</p>
<ul>
<li>congestion_<strong>unaware</strong> analytical network simulator</li>
<li>congestion_<strong>aware</strong> analytical network simulator</li>
</ul>
<hr>
<ul>
<li>T<strong>Topology</strong></li>
</ul>
<p>Analytical Network æ”¯æŒä¸‰ç§æ‹“æ‰‘ç»“æ„: Ring, FullConnected, Switch. å¹¶ä¸”å¯ä»¥å †å æ¥è¡¨ç¤ºå¤šç»´ç½‘ç»œã€‚</p>
<p>
<figure class="post-figure">
    <a href="https://astra-sim.github.io/astra-network-analytical-docs/_images/network-building-blocks.svg" target="_blank" rel="noopener">
        <img loading="lazy" src="https://astra-sim.github.io/astra-network-analytical-docs/_images/network-building-blocks.svg" alt="Basic Network Building Block">
    </a><figcaption>Basic Network Building Block</figcaption></figure></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">topology</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="l">Ring, Switch ] </span><span class="w"> </span><span class="c"># 2D topology</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">topology</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="l">Ring, Ring, Ring ] </span><span class="w"> </span><span class="c"># 3D topology</span><span class="w">
</span></span></span></code></pre></div><p>
<figure class="post-figure">
    <a href="https://astra-sim.github.io/astra-network-analytical-docs/_images/multidim-network-example.svg" target="_blank" rel="noopener">
        <img loading="lazy" src="https://astra-sim.github.io/astra-network-analytical-docs/_images/multidim-network-example.svg" alt="Example of 2D &amp; 3D Topologies">
    </a><figcaption>Example of 2D &amp; 3D Topologies</figcaption></figure></p>
<hr>
<ul>
<li><strong>NPUs Count</strong></li>
</ul>
<p>æŒ‡å®šäº†æ¯ä¸ªç»´åº¦ä¸Šçš„è®¾å¤‡æ•°ç›®</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">npus_count</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="p">]</span><span class="w">  </span><span class="c"># 5 NPUs</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">npus_count</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="p">]</span><span class="w">  </span><span class="c"># 4 Ã— 2 = 8 NPUs</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">npus_count</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="p">]</span><span class="w">  </span><span class="c"># 4 Ã— 2 Ã— 2 = 16 NPUs</span><span class="w">
</span></span></span></code></pre></div><p>
<figure class="post-figure">
    <a href="https://astra-sim.github.io/astra-network-analytical-docs/_images/npus-count-example.svg" target="_blank" rel="noopener">
        <img loading="lazy" src="https://astra-sim.github.io/astra-network-analytical-docs/_images/npus-count-example.svg" alt="NPUs Count Example">
    </a><figcaption>NPUs Count Example</figcaption></figure></p>
<hr>
<ul>
<li><strong>Bandwidth</strong> &amp; <strong>Latency</strong></li>
</ul>
<p><code>latency</code> å®šä¹‰äº†æ¯æ¡å•å‘é“¾è·¯çš„å»¶è¿Ÿ (ns).
<code>bandwidth</code> å®šä¹‰äº†æ¯æ¡å•å‘é“¾è·¯çš„å¸¦å®½ (GB/s).</p>
<div class="notice note" >
    <p class="notice-title">
        <span class="icon-notice baseline">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 128 300 300">
  <path d="M150 128c82.813 0 150 67.188 150 150 0 82.813-67.188 150-150 150C67.187 428 0 360.812 0 278c0-82.813 67.188-150 150-150Zm25 243.555v-37.11c0-3.515-2.734-6.445-6.055-6.445h-37.5c-3.515 0-6.445 2.93-6.445 6.445v37.11c0 3.515 2.93 6.445 6.445 6.445h37.5c3.32 0 6.055-2.93 6.055-6.445Zm-.39-67.188 3.515-121.289c0-1.367-.586-2.734-1.953-3.516-1.172-.976-2.93-1.562-4.688-1.562h-42.968c-1.758 0-3.516.586-4.688 1.563-1.367.78-1.953 2.148-1.953 3.515l3.32 121.29c0 2.734 2.93 4.882 6.64 4.882h36.134c3.515 0 6.445-2.148 6.64-4.883Z"/>
</svg>

        </span>Note</p><p>$1 GB = 2^{30} B$ and $1 s = 10^9 ns$</p></div>

<h2 id="ns3-backend">ns3 backend<a hidden class="anchor" aria-hidden="true" href="#ns3-backend">#</a></h2>
<p>ä¸‹é¢æ˜¯ç”¨ ns3 åç«¯è¿›è¡Œæ–¹é’ˆçš„ä¸€ä¸ªæ‰§è¡Œå‘½ä»¤ã€‚è¿™é‡Œä½¿ç”¨äº† <code>--network-backend</code> å’Œ <code>--logical-topology</code> è¿™ä¸¤ä¸ªå‚æ•°ã€‚éœ€è¦è¯´æ˜çš„æ˜¯ï¼ŒAnalytical Backend ä¸­ä»…ä½¿ç”¨äº†-<code>-network-backend</code> å‚æ•°ï¼Œè¿™æ˜¯å› ä¸ºåˆ†æå‹åç«¯çš„é€»è¾‘æ‹“æ‰‘ä¸ç‰©ç†æ‹“æ‰‘æ˜¯ç›¸åŒçš„ï¼Œè€Œ ns3 åˆ™å…è®¸æˆ‘ä»¬å°†é€»è¾‘æ‹“æ‰‘ä¸ç‰©ç†æ‹“æ‰‘åˆ†ç¦»ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">   <span class="c1"># {NS3_DIR} is the directory of the ns-3 backend. That is, &#39;{ASTRA_SIM_ROOT_DIRECTORY}/extern/network_backend/ns-3&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">cd</span> <span class="s2">&#34;</span><span class="si">${</span><span class="nv">NS3_DIR</span><span class="si">}</span><span class="s2">/build/scratch&#34;</span>
</span></span><span class="line"><span class="cl">    ./ns3.42-AstraSimNetwork-default <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>        --workload-configuration<span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">SCRIPT_DIR</span><span class="p">:?</span><span class="si">}</span><span class="s2">&#34;</span>/../../extern/graph_frontend/chakra/one_comm_coll_node_allgather  <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>        --system-configuration<span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">SCRIPT_DIR</span><span class="p">:?</span><span class="si">}</span><span class="s2">&#34;</span>/../../inputs/system/Switch.json  <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>        --network-configuration<span class="o">=</span><span class="s2">&#34;../../../ns-3/scratch/config/config.txt&#34;</span>   <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>        --remote-memory-configuration<span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">SCRIPT_DIR</span><span class="p">:?</span><span class="si">}</span><span class="s2">&#34;</span>/../../inputs/remote_memory/analytical/no_memory_expansion.json <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>        --logical-topology-configuration<span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">SCRIPT_DIR</span><span class="p">:?</span><span class="si">}</span><span class="s2">&#34;</span>/../../inputs/network/ns3/sample_8nodes_1D.json   <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>        --comm-group-configuration<span class="o">=</span><span class="se">\&#34;</span>empty<span class="se">\&#34;</span>
</span></span></code></pre></div><hr>
<div class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1">
<p><a href="https://github.com/mlcommons/chakra/wiki/Chakra-Execution-Trace-Collection-%E2%80%90-A-Comprehensive-Guide-on-Merging-PyTorch-and-Kineto-Traces#2-overview-of-trace-collection-and-simulation-methodology">Overview of Trace Collection</a>&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</div>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="http://localhost:1313/tags/astra-sim/">Astra-Sim</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="http://localhost:1313/blogs/tx8read/">
    <span class="title">Â« Prev</span>
    <br>
    <span>Tx8read</span>
  </a>
  <a class="next" href="http://localhost:1313/blogs/transformerfamily/">
    <span class="title">Next Â»</span>
    <br>
    <span>Transformer Family</span>
  </a>
</nav>

  </footer><script src="https://giscus.app/client.js"
        data-repo="jamesnulliu/jamesnulliu.github.io"
        data-repo-id="R_kgDOMPCQIw"
        data-category="Announcements"
        data-category-id="DIC_kwDOMPCQI84Cgb2t"
        data-mapping="pathname"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="bottom"
        data-theme="preferred_color_scheme"
        data-lang="en"
        crossorigin="anonymous"
        async>
</script>
</article>
    </main>
    
<footer class="footer">
        <span>Â© 2024-2025 WITHER</span> Â· 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
